import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e as n,o as t}from"./app-DkVa7Hgi.js";const h={};function e(l,s){return t(),a("div",null,s[0]||(s[0]=[n(`<p><code>immer</code> æ˜¯ä¸€ä¸ªç”¨äº <strong>ä¸å¯å˜æ•°æ®ç®¡ç†</strong> çš„ JavaScript åº“ï¼Œé€šå¸¸ç”¨äº <strong>Reactã€Reduxã€MobX</strong> ç­‰çŠ¶æ€ç®¡ç†ä¸­ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>è®©æˆ‘ä»¬èƒ½å¤Ÿä»¥â€œå¯å˜â€çš„æ–¹å¼ç¼–å†™ä¸å¯å˜æ•°æ®æ›´æ–°é€»è¾‘</strong>ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="ğŸŒŸ-ä¸ºä»€ä¹ˆéœ€è¦-immer" tabindex="-1"><a class="header-anchor" href="#ğŸŒŸ-ä¸ºä»€ä¹ˆéœ€è¦-immer"><span><strong>ğŸŒŸ ä¸ºä»€ä¹ˆéœ€è¦ <code>immer</code>?</strong></span></a></h3><p>åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„å’Œå¯¹è±¡æ˜¯<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹å®ƒä»¬ä¼šå½±å“åŸæ•°æ®ï¼Œå¯¼è‡´ React æˆ– Redux <strong>çŠ¶æ€ç®¡ç†å‡ºé—®é¢˜</strong>ã€‚</p><p>ä¼ ç»Ÿåšæ³•ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> newState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }; </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// { count: 1 }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <code>immer</code>ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> produce</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;immer&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> newState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> produce</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">draft</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// { count: 1 }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ä¼ ç»Ÿæ–¹æ³•</strong> éœ€è¦æ‰‹åŠ¨ <code>...</code> å±•å¼€å¯¹è±¡ï¼Œå®¹æ˜“å‡ºé”™ã€‚</li><li><strong><code>immer</code></strong> å…è®¸æˆ‘ä»¬åƒç›´æ¥ä¿®æ”¹å¯¹è±¡ä¸€æ ·å†™ä»£ç ï¼Œå†…éƒ¨è‡ªåŠ¨å¤„ç† <strong>ä¸å¯å˜æ•°æ®</strong>ã€‚</li></ul><hr><h2 id="ğŸ“Œ-immer-çš„æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#ğŸ“Œ-immer-çš„æ ¸å¿ƒæ¦‚å¿µ"><span><strong>ğŸ“Œ <code>immer</code> çš„æ ¸å¿ƒæ¦‚å¿µ</strong></span></a></h2><h3 id="_1-produce" tabindex="-1"><a class="header-anchor" href="#_1-produce"><span><strong>1. <code>produce()</code></strong></span></a></h3><p><code>produce(baseState, producerFunction)</code> æ˜¯ <code>immer</code> çš„æ ¸å¿ƒæ–¹æ³•ï¼Œå®ƒä¼šåˆ›å»º <code>baseState</code> çš„ <strong>å‰¯æœ¬</strong>ï¼Œç„¶å<strong>å…è®¸åœ¨ <code>producerFunction</code> é‡Œç›´æ¥ä¿®æ”¹å‰¯æœ¬</strong>ï¼Œæœ€åè¿”å›ä¸€ä¸ªæ–°çš„ä¸å¯å˜ <code>state</code>ã€‚</p><p><strong>ğŸŒŸ ä¾‹å­ï¼š</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> produce</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;immer&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;å¼ ä¸‰&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 25</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> newState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> produce</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">draft</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç›´æ¥ä¿®æ”¹ draft</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// { name: &quot;å¼ ä¸‰&quot;, age: 26 }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);    </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// { name: &quot;å¼ ä¸‰&quot;, age: 25 } (åŸæ•°æ®ä¸å˜)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸš€ <strong>ä½ å¯ä»¥åƒä¿®æ”¹æ™®é€šå¯¹è±¡ä¸€æ ·å†™ä»£ç ï¼Œimmer å†…éƒ¨ä¼šè‡ªåŠ¨ç®¡ç†ä¸å¯å˜æ•°æ®ï¼</strong></p><hr><h3 id="_2-ä¿®æ”¹åµŒå¥—å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_2-ä¿®æ”¹åµŒå¥—å¯¹è±¡"><span><strong>2. ä¿®æ”¹åµŒå¥—å¯¹è±¡</strong></span></a></h3><p>å¦‚æœå¯¹è±¡åµŒå¥—è¾ƒæ·±ï¼Œä½¿ç”¨ <code>immer</code> <strong>å¯ä»¥é¿å…æ‰‹åŠ¨å±•å¼€ <code>...</code> å¯¹è±¡</strong>ï¼Œæé«˜å¯è¯»æ€§ã€‚</p><p><strong>ä¸ä½¿ç”¨ <code>immer</code>ï¼š</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;å¼ ä¸‰&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> } } };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> newState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">  ...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  user</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">    ...</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    profile</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">      ...</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      name</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;æå››&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// éœ€è¦æ‰‹åŠ¨å±•å¼€å¤šå±‚</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨ <code>immer</code>ï¼š</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> newState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> produce</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">draft</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;æå››&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä»£ç ç®€æ´ï¼Œæ˜“è¯»</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_3-immer-å¤„ç†æ•°ç»„" tabindex="-1"><a class="header-anchor" href="#_3-immer-å¤„ç†æ•°ç»„"><span><strong>3. <code>immer</code> å¤„ç†æ•°ç»„</strong></span></a></h3><p>æ•°ç»„åœ¨ Redux æˆ– React çŠ¶æ€ç®¡ç†ä¸­å¾ˆå¸¸è§ï¼Œ<code>immer</code> ä¹Ÿèƒ½è½»æ¾å¤„ç†å®ƒä»¬ã€‚</p><h4 id="æ·»åŠ ã€åˆ é™¤å…ƒç´ " tabindex="-1"><a class="header-anchor" href="#æ·»åŠ ã€åˆ é™¤å…ƒç´ "><span><strong>æ·»åŠ ã€åˆ é™¤å…ƒç´ </strong></span></a></h4><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> newState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> produce</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">draft</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ·»åŠ å…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 99</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä¿®æ”¹å…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">splice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// [99, 3, 4]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ”¥ <strong>ä¼ ç»Ÿæ–¹å¼éœ€è¦ <code>map()</code>ã€<code>filter()</code>ï¼Œ<code>immer</code> è®©æ“ä½œæ•°ç»„å˜å¾—ç›´è§‚ã€‚</strong></p><hr><h3 id="_4-åœ¨-redux-ä¸­ä½¿ç”¨-immer" tabindex="-1"><a class="header-anchor" href="#_4-åœ¨-redux-ä¸­ä½¿ç”¨-immer"><span><strong>4. åœ¨ Redux ä¸­ä½¿ç”¨ <code>immer</code></strong></span></a></h3><p>åœ¨ Redux <code>reducer</code> é‡Œï¼Œæˆ‘ä»¬å¿…é¡»<strong>è¿”å›æ–°çš„ <code>state</code></strong>ï¼Œä¸èƒ½ä¿®æ”¹åŸ <code>state</code>ï¼Œä½† <code>immer</code> å¯ä»¥ç®€åŒ–è¿™éƒ¨åˆ†ä»£ç ã€‚</p><p><strong>âŒ ä¸ä½¿ç”¨ <code>immer</code>ï¼š</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> reducer</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  switch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    case</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;INCREMENT&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>âœ… ä½¿ç”¨ <code>immer</code>ï¼š</strong></p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> produce</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;immer&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> reducer</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> produce</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">draft</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    switch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      case</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;INCREMENT&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">        draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        break</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ’¡ <strong>é¿å… <code>...</code> å±•å¼€æ“ä½œï¼Œä»£ç æ›´æ˜“è¯»ã€‚</strong></p><hr><h2 id="ğŸ¯-immer-é«˜çº§ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-immer-é«˜çº§ç‰¹æ€§"><span><strong>ğŸ¯ <code>immer</code> é«˜çº§ç‰¹æ€§</strong></span></a></h2><h3 id="_1-produce-ç›´æ¥ä¼ å…¥å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#_1-produce-ç›´æ¥ä¼ å…¥å‡½æ•°"><span><strong>1. <code>produce()</code> ç›´æ¥ä¼ å…¥å‡½æ•°</strong></span></a></h3><p>æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½ä¸æƒ³æ¯æ¬¡éƒ½æ‰‹åŠ¨ä¼ å…¥ <code>state</code>ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ <code>produce</code> ç”Ÿæˆ <strong>å¯å¤ç”¨çš„ <code>updater</code></strong>ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> increment</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> produce</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">draft</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> newState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> increment</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// { count: 1 }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_2-producewithpatches-ç›‘å¬æ•°æ®å˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_2-producewithpatches-ç›‘å¬æ•°æ®å˜åŒ–"><span><strong>2. <code>produceWithPatches()</code> ç›‘å¬æ•°æ®å˜åŒ–</strong></span></a></h3><p><code>produceWithPatches()</code> å…è®¸ä½ <strong>è·å– <code>state</code> å˜åŒ–çš„è¡¥ä¸ï¼ˆpatchesï¼‰</strong>ï¼Œè¿™åœ¨ <strong>æ—¶é—´æ—…è¡Œã€æ’¤é”€ï¼ˆundo/redoï¼‰åŠŸèƒ½</strong> ä¸­å¾ˆæœ‰ç”¨ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">produceWithPatches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;immer&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">patches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">inversePatches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> produceWithPatches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">draft</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  draft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">newState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// { count: 1 }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">patches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// [{ op: &quot;replace&quot;, path: [&quot;count&quot;], value: 1 }]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">inversePatches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// [{ op: &quot;replace&quot;, path: [&quot;count&quot;], value: 0 }]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“Œ <strong>åº”ç”¨åœºæ™¯ï¼š</strong> <strong>æ’¤é”€ï¼ˆUndoï¼‰å’Œé‡åšï¼ˆRedoï¼‰</strong> åŠŸèƒ½ï¼Œå­˜å‚¨ <code>patches</code> ä»¥å›æ»šçŠ¶æ€ã€‚</p><hr><h2 id="ğŸš€-immer-vs-ä¼ ç»Ÿæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ğŸš€-immer-vs-ä¼ ç»Ÿæ–¹å¼"><span><strong>ğŸš€ <code>immer</code> VS ä¼ ç»Ÿæ–¹å¼</strong></span></a></h2><table><thead><tr><th><strong>å¯¹æ¯”é¡¹</strong></th><th><strong>ä¼ ç»Ÿæ–¹å¼</strong></th><th><strong><code>immer</code></strong></th></tr></thead><tbody><tr><td><strong>è¯­æ³•å¤æ‚åº¦</strong></td><td>éœ€è¦ <code>spread</code> å±•å¼€ (<code>...</code>)</td><td>ç›´æ¥ä¿®æ”¹ <code>draft</code></td></tr><tr><td><strong>åµŒå¥—å¯¹è±¡ä¿®æ”¹</strong></td><td>éœ€è¦å¤šå±‚ <code>spread</code></td><td>ç›´æ¥ä¿®æ”¹ <code>draft</code></td></tr><tr><td><strong>æ•°ç»„ä¿®æ”¹</strong></td><td>éœ€è¦ <code>map()</code>ã€<code>filter()</code></td><td>ç›´æ¥ä¿®æ”¹ <code>draft</code></td></tr><tr><td><strong>å¯è¯»æ€§</strong></td><td>ä»£ç å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™</td><td>ç®€æ´ç›´è§‚</td></tr></tbody></table><hr><h2 id="ğŸ› -ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-immer" tabindex="-1"><a class="header-anchor" href="#ğŸ› -ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-immer"><span><strong>ğŸ›  ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ <code>immer</code>?</strong></span></a></h2><p>âœ… é€‚ç”¨äºï¼š</p><ul><li>éœ€è¦ä¸å¯å˜æ•°æ®çš„ <strong>React çŠ¶æ€ç®¡ç†</strong></li><li><strong>Redux reducers</strong>ï¼ˆé¿å… <code>...</code> è¯­æ³•ï¼‰</li><li>éœ€è¦æ“ä½œ<strong>æ·±å±‚åµŒå¥—å¯¹è±¡</strong>çš„åœºæ™¯</li><li>éœ€è¦<strong>æ’¤é”€/é‡åš</strong>ï¼ˆUndo/Redoï¼‰åŠŸèƒ½æ—¶</li></ul><p>âŒ ä¸é€‚ç”¨äºï¼š</p><ul><li><strong>ä¸éœ€è¦ä¸å¯å˜æ•°æ®çš„é¡¹ç›®</strong>ï¼ˆæ™®é€š JavaScript å¯å˜å¯¹è±¡æ›´ç®€å•ï¼‰</li><li><strong>æ•°æ®é‡ç‰¹åˆ«å¤§çš„åœºæ™¯</strong>ï¼ˆ<code>immer</code> ä¼šåˆ›å»ºå‰¯æœ¬ï¼Œå¯èƒ½å½±å“æ€§èƒ½ï¼‰</li></ul><hr><h2 id="ğŸ”§-ç»“è®º" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-ç»“è®º"><span><strong>ğŸ”§ ç»“è®º</strong></span></a></h2><ul><li><code>immer</code> è®©ä¸å¯å˜æ•°æ® <strong>æ“ä½œæ›´ç®€å•</strong></li><li>é€‚ç”¨äº <strong>Reduxã€React çŠ¶æ€ç®¡ç†</strong></li><li><strong>æ·±å±‚å¯¹è±¡ã€æ•°ç»„</strong> ä¿®æ”¹éå¸¸æ–¹ä¾¿</li><li><strong>æ’¤é”€/é‡åšåŠŸèƒ½</strong>ï¼ˆUndo/Redoï¼‰å¯ç”¨ <code>produceWithPatches()</code></li></ul><hr><h2 id="ğŸ“Œ-å‚è€ƒèµ„æ–™" tabindex="-1"><a class="header-anchor" href="#ğŸ“Œ-å‚è€ƒèµ„æ–™"><span><strong>ğŸ“Œ å‚è€ƒèµ„æ–™</strong></span></a></h2><p>ğŸ”— <code>immer</code> å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://immerjs.github.io/immer/" target="_blank" rel="noopener noreferrer">https://immerjs.github.io/immer/</a></p>`,61)]))}const r=i(h,[["render",e]]),d=JSON.parse('{"path":"/posts/react/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/immer.html","title":"immer","lang":"zh-CN","frontmatter":{"title":"immer","tags":["react"],"description":"immer æ˜¯ä¸€ä¸ªç”¨äº ä¸å¯å˜æ•°æ®ç®¡ç† çš„ JavaScript åº“ï¼Œé€šå¸¸ç”¨äº Reactã€Reduxã€MobX ç­‰çŠ¶æ€ç®¡ç†ä¸­ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯è®©æˆ‘ä»¬èƒ½å¤Ÿä»¥â€œå¯å˜â€çš„æ–¹å¼ç¼–å†™ä¸å¯å˜æ•°æ®æ›´æ–°é€»è¾‘ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ğŸŒŸ ä¸ºä»€ä¹ˆéœ€è¦ immer? åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„å’Œå¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹å®ƒä»¬ä¼šå½±å“åŸæ•°æ®ï¼Œå¯¼è‡´ Reac...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/zy-vuepress/posts/react/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/immer.html"}],["meta",{"property":"og:site_name","content":"æˆ‘çš„åŸºåœ°"}],["meta",{"property":"og:title","content":"immer"}],["meta",{"property":"og:description","content":"immer æ˜¯ä¸€ä¸ªç”¨äº ä¸å¯å˜æ•°æ®ç®¡ç† çš„ JavaScript åº“ï¼Œé€šå¸¸ç”¨äº Reactã€Reduxã€MobX ç­‰çŠ¶æ€ç®¡ç†ä¸­ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯è®©æˆ‘ä»¬èƒ½å¤Ÿä»¥â€œå¯å˜â€çš„æ–¹å¼ç¼–å†™ä¸å¯å˜æ•°æ®æ›´æ–°é€»è¾‘ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ğŸŒŸ ä¸ºä»€ä¹ˆéœ€è¦ immer? åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„å’Œå¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹å®ƒä»¬ä¼šå½±å“åŸæ•°æ®ï¼Œå¯¼è‡´ Reac..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-07T05:44:35.000Z"}],["meta",{"property":"article:tag","content":"react"}],["meta",{"property":"article:modified_time","content":"2025-05-07T05:44:35.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"immer\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-05-07T05:44:35.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mrs.Zoe\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":3,"title":"ğŸŒŸ ä¸ºä»€ä¹ˆéœ€è¦ immer?","slug":"ğŸŒŸ-ä¸ºä»€ä¹ˆéœ€è¦-immer","link":"#ğŸŒŸ-ä¸ºä»€ä¹ˆéœ€è¦-immer","children":[]},{"level":2,"title":"ğŸ“Œ immer çš„æ ¸å¿ƒæ¦‚å¿µ","slug":"ğŸ“Œ-immer-çš„æ ¸å¿ƒæ¦‚å¿µ","link":"#ğŸ“Œ-immer-çš„æ ¸å¿ƒæ¦‚å¿µ","children":[{"level":3,"title":"1. produce()","slug":"_1-produce","link":"#_1-produce","children":[]},{"level":3,"title":"2. ä¿®æ”¹åµŒå¥—å¯¹è±¡","slug":"_2-ä¿®æ”¹åµŒå¥—å¯¹è±¡","link":"#_2-ä¿®æ”¹åµŒå¥—å¯¹è±¡","children":[]},{"level":3,"title":"3. immer å¤„ç†æ•°ç»„","slug":"_3-immer-å¤„ç†æ•°ç»„","link":"#_3-immer-å¤„ç†æ•°ç»„","children":[]},{"level":3,"title":"4. åœ¨ Redux ä¸­ä½¿ç”¨ immer","slug":"_4-åœ¨-redux-ä¸­ä½¿ç”¨-immer","link":"#_4-åœ¨-redux-ä¸­ä½¿ç”¨-immer","children":[]}]},{"level":2,"title":"ğŸ¯ immer é«˜çº§ç‰¹æ€§","slug":"ğŸ¯-immer-é«˜çº§ç‰¹æ€§","link":"#ğŸ¯-immer-é«˜çº§ç‰¹æ€§","children":[{"level":3,"title":"1. produce() ç›´æ¥ä¼ å…¥å‡½æ•°","slug":"_1-produce-ç›´æ¥ä¼ å…¥å‡½æ•°","link":"#_1-produce-ç›´æ¥ä¼ å…¥å‡½æ•°","children":[]},{"level":3,"title":"2. produceWithPatches() ç›‘å¬æ•°æ®å˜åŒ–","slug":"_2-producewithpatches-ç›‘å¬æ•°æ®å˜åŒ–","link":"#_2-producewithpatches-ç›‘å¬æ•°æ®å˜åŒ–","children":[]}]},{"level":2,"title":"ğŸš€ immer VS ä¼ ç»Ÿæ–¹å¼","slug":"ğŸš€-immer-vs-ä¼ ç»Ÿæ–¹å¼","link":"#ğŸš€-immer-vs-ä¼ ç»Ÿæ–¹å¼","children":[]},{"level":2,"title":"ğŸ›  ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ immer?","slug":"ğŸ› -ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-immer","link":"#ğŸ› -ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-immer","children":[]},{"level":2,"title":"ğŸ”§ ç»“è®º","slug":"ğŸ”§-ç»“è®º","link":"#ğŸ”§-ç»“è®º","children":[]},{"level":2,"title":"ğŸ“Œ å‚è€ƒèµ„æ–™","slug":"ğŸ“Œ-å‚è€ƒèµ„æ–™","link":"#ğŸ“Œ-å‚è€ƒèµ„æ–™","children":[]}],"git":{"createdTime":1744782534000,"updatedTime":1746596675000,"contributors":[{"name":"zy","username":"zy","email":"891374900@qq.com","commits":1,"url":"https://github.com/zy"},{"name":"zouyu","username":"zouyu","email":"891374900@qq.com","commits":1,"url":"https://github.com/zouyu"}]},"readingTime":{"minutes":3.38,"words":1013},"filePathRelative":"posts/react/çŠ¶æ€ç®¡ç†/immer.md","localizedDate":"2025å¹´4æœˆ16æ—¥","excerpt":"<p><code>immer</code> æ˜¯ä¸€ä¸ªç”¨äº <strong>ä¸å¯å˜æ•°æ®ç®¡ç†</strong> çš„ JavaScript åº“ï¼Œé€šå¸¸ç”¨äº <strong>Reactã€Reduxã€MobX</strong> ç­‰çŠ¶æ€ç®¡ç†ä¸­ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯<strong>è®©æˆ‘ä»¬èƒ½å¤Ÿä»¥â€œå¯å˜â€çš„æ–¹å¼ç¼–å†™ä¸å¯å˜æ•°æ®æ›´æ–°é€»è¾‘</strong>ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>\\n<h3><strong>ğŸŒŸ ä¸ºä»€ä¹ˆéœ€è¦ <code>immer</code>?</strong></h3>\\n<p>åœ¨ JavaScript ä¸­ï¼Œæ•°ç»„å’Œå¯¹è±¡æ˜¯<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œæ‰€ä»¥ç›´æ¥ä¿®æ”¹å®ƒä»¬ä¼šå½±å“åŸæ•°æ®ï¼Œå¯¼è‡´ React æˆ– Redux <strong>çŠ¶æ€ç®¡ç†å‡ºé—®é¢˜</strong>ã€‚</p>","autoDesc":true}');export{r as comp,d as data};
