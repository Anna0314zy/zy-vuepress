import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e as n,o as l}from"./app-DkVa7Hgi.js";const e={};function t(h,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h2 id="ğŸ§ -ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ"><span>ğŸ§  ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ</span></a></h2><p>React æ¸²æŸ“åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ol><li><strong>è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰</strong>ï¼šæ”¶é›†æ›´æ–°è¯·æ±‚å¹¶å®‰æ’ä¼˜å…ˆçº§</li><li><strong>æ¸²æŸ“é˜¶æ®µï¼ˆRender Phaseï¼‰</strong>ï¼šæ„å»ºå¹¶ diff Fiber æ ‘ï¼Œæ ‡è®°æ‰€æœ‰å˜æ›´</li><li><strong>æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰</strong>ï¼šä¸€æ¬¡æ€§å°†æ‰€æœ‰å˜æ›´åº”ç”¨åˆ° DOMï¼Œå¹¶æ‰§è¡Œå‰¯ä½œç”¨</li></ol><hr><h2 id="_1-ğŸŸ¡-è°ƒåº¦é˜¶æ®µ-schedule-phase" tabindex="-1"><a class="header-anchor" href="#_1-ğŸŸ¡-è°ƒåº¦é˜¶æ®µ-schedule-phase"><span>1. ğŸŸ¡ è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰</span></a></h2><ul><li><strong>è§¦å‘æ›´æ–°</strong>ï¼šè°ƒç”¨ <code>setState</code>ã€<code>dispatch</code>ã€<code>useState</code> æ›´æ–° Hook ç­‰ã€‚</li><li><strong>æ³¨å†Œä»»åŠ¡</strong>ï¼š<code>scheduleUpdateOnFiber(fiber, lane)</code> ä¼šå°†æ›´æ–°åŠ å…¥è°ƒåº¦é˜Ÿåˆ—ï¼Œå¹¶æ ‡è®°ä¼˜å…ˆçº§ï¼ˆLaneï¼‰ã€‚</li><li><strong>æ—¶é—´åˆ‡ç‰‡ &amp; å¹¶å‘</strong>ï¼šå€ŸåŠ© Schedulerï¼ŒReact å¯åœ¨ä¸­æ–­ç‚¹æš‚åœæ¸²æŸ“ï¼Œå°†é«˜ä¼˜å…ˆçº§ä»»åŠ¡æ’å…¥ï¼Œä¿è¯ç•Œé¢å“åº”æµç•…ã€‚</li></ul><hr><h2 id="_2-ğŸ”µ-æ¸²æŸ“é˜¶æ®µ-render-phase" tabindex="-1"><a class="header-anchor" href="#_2-ğŸ”µ-æ¸²æŸ“é˜¶æ®µ-render-phase"><span>2. ğŸ”µ æ¸²æŸ“é˜¶æ®µï¼ˆRender Phaseï¼‰</span></a></h2><blockquote><p>æ„å»ºæ–°çš„ Fiber æ ‘ï¼ˆ<code>workInProgress</code>ï¼‰ï¼Œå¹¶ä¸æ—§æ ‘ï¼ˆ<code>current</code>ï¼‰åš diffï¼Œæ”¶é›†æ‰€æœ‰å˜æ›´æ ‡è®°ï¼ˆflagsï¼‰ã€‚</p></blockquote><h3 id="_2-1-éå†ç­–ç•¥-â€”â€”-æ·±åº¦ä¼˜å…ˆ-dfs" tabindex="-1"><a class="header-anchor" href="#_2-1-éå†ç­–ç•¥-â€”â€”-æ·±åº¦ä¼˜å…ˆ-dfs"><span>2.1 éå†ç­–ç•¥ â€”â€” æ·±åº¦ä¼˜å…ˆï¼ˆDFSï¼‰</span></a></h3><ol><li><strong>å¼€å§‹</strong>ï¼š<code>performConcurrentWorkOnRoot()</code> â†’ <code>workLoop</code> â†’ <code>beginWork(root)</code></li><li><strong>å‘ä¸‹</strong>ï¼šå¤„ç†å½“å‰ Fiber çš„ <code>beginWork</code>ï¼Œé€’å½’éå† <code>child</code></li><li><strong>æ¨ªå‘</strong>ï¼šè‹¥æ— å­èŠ‚ç‚¹ï¼Œæˆ–å­èŠ‚ç‚¹å·²å®Œæˆï¼Œåˆ‡æ¢åˆ° <code>sibling</code></li><li><strong>å›æº¯</strong>ï¼šå…„å¼ŸèŠ‚ç‚¹ä¹Ÿæ— å¾…å¤„ç†æ—¶ï¼Œå›åˆ°çˆ¶èŠ‚ç‚¹ï¼Œè¿›å…¥ <code>completeWork</code></li><li><strong>å¾ªç¯</strong>ï¼šä¸Šè¿°æ­¥éª¤åå¤ï¼Œç›´åˆ°æ•´æ£µ Fiber æ ‘éå†å®Œæ¯•</li></ol><h3 id="_2-2-diff-æ ‡è®°å˜æ›´" tabindex="-1"><a class="header-anchor" href="#_2-2-diff-æ ‡è®°å˜æ›´"><span>2.2 Diff &amp; æ ‡è®°å˜æ›´</span></a></h3><p>åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ <code>beginWork</code> ä¸­ï¼Œè°ƒç”¨ <code>reconcileChildren(current, workInProgress, nextChildren)</code>ï¼š</p><ul><li><p><strong>Key æ¯”å¯¹</strong>ï¼šå…ˆæ ¹æ® <code>key</code> åŒ¹é…åŒçº§èŠ‚ç‚¹</p></li><li><p><strong>ç±»å‹æ¯”å¯¹</strong>ï¼šè‹¥ key ç›¸åŒï¼Œå†æ¯”å¯¹ <code>type</code>ï¼ˆå‡½æ•°ç»„ä»¶ã€Classã€DOMï¼‰</p><ul><li><strong>ç±»å‹ä¸åŒ</strong>ï¼šæ—§èŠ‚ç‚¹æ‰“ <code>Deletion</code>ï¼Œæ–°èŠ‚ç‚¹æ‰“ <code>Placement</code></li><li><strong>ç±»å‹ç›¸åŒ</strong>ï¼šå¤ç”¨æ—§èŠ‚ç‚¹ï¼Œæ¯”è¾ƒ <code>props</code>ï¼Œè‹¥æœ‰å·®å¼‚åˆ™æ‰“ <code>Update</code></li></ul></li></ul><p>æ‰€æœ‰è¿™äº›å˜æ›´ä¼šå†™å…¥å½“å‰ Fiber çš„ <code>flags</code>ã€‚</p><h3 id="_2-3-completework-æ”¶é›†å‰¯ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#_2-3-completework-æ”¶é›†å‰¯ä½œç”¨"><span>2.3 completeWorkï¼šæ”¶é›†å‰¯ä½œç”¨</span></a></h3><p>å½“æŸä¸ªå­æ ‘éå†ç»“æŸåï¼Œ<code>completeWork</code> ä¼šï¼š</p><ul><li>åˆ›å»ºï¼æ›´æ–°çœŸå® DOMï¼ˆä»… <code>HostComponent</code>ï¼‰å¹¶èµ‹ç»™ <code>stateNode</code></li><li>å°†è‡ªèº«åŠå­æ ‘ä¸­æ‰€æœ‰å¸¦ <code>flags</code> çš„ Fiberï¼Œé€šè¿‡ <code>firstEffect</code>/<code>lastEffect</code> å’Œ <code>nextEffect</code> ä¸²æˆ <strong>effect list</strong></li></ul><hr><h2 id="_3-ğŸ”´-æäº¤é˜¶æ®µ-commit-phase" tabindex="-1"><a class="header-anchor" href="#_3-ğŸ”´-æäº¤é˜¶æ®µ-commit-phase"><span>3. ğŸ”´ æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰</span></a></h2><blockquote><p>åœ¨æ­¤é˜¶æ®µï¼ŒReact ä¸€æ¬¡æ€§éå†æ•´æ£µ effect listï¼Œæ‰§è¡Œæ‰€æœ‰å‰¯ä½œç”¨â€”â€”DOM æ“ä½œä¸ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¸å¯ä¸­æ–­ã€‚</p></blockquote><ol><li><p><strong>Before Mutation</strong></p><ul><li>æ‰§è¡Œè¯¸å¦‚ <code>getSnapshotBeforeUpdate</code> ç­‰é¢„å¤„ç†</li></ul></li><li><p><strong>Mutation Phase</strong></p><ul><li><p>éå† effect listï¼Œé’ˆå¯¹æ¯ä¸ª Fiber æ ¹æ® <code>flags</code> è°ƒç”¨ï¼š</p><ul><li><code>Placement</code> â†’ æ’å…¥æ–° DOM</li><li><code>Update</code> â†’ æ›´æ–°å±æ€§ï¼æ–‡æœ¬</li><li><code>Deletion</code> â†’ ç§»é™¤ DOM</li></ul></li></ul></li><li><p><strong>Layout Phase</strong></p><ul><li>æ‰§è¡ŒåŒæ­¥å‰¯ä½œç”¨ï¼š<code>useLayoutEffect</code> çš„å›è°ƒã€ç±»ç»„ä»¶çš„ <code>componentDidMount</code>ï¼<code>componentDidUpdate</code></li></ul></li></ol><blockquote><p><strong>æ³¨æ„</strong>ï¼š<code>useEffect</code>ï¼ˆå¼‚æ­¥å‰¯ä½œç”¨ï¼‰ä¼šåœ¨æäº¤é˜¶æ®µç»“æŸåï¼Œå¼‚æ­¥åœ°åœ¨ â€œpassive effectsâ€ é˜Ÿåˆ—ä¸­è¢«è§¦å‘ã€‚</p></blockquote><hr><h2 id="âœ¨-å°ç»“" tabindex="-1"><a class="header-anchor" href="#âœ¨-å°ç»“"><span>âœ¨ å°ç»“</span></a></h2><ul><li><strong>è°ƒåº¦é˜¶æ®µ</strong>ï¼šæ”¶é›†æ›´æ–°ã€æ’å®šä¼˜å…ˆçº§ï¼Œå†³å®šä½•æ—¶è¿›å…¥æ¸²æŸ“ã€‚</li><li><strong>æ¸²æŸ“é˜¶æ®µ</strong>ï¼šDFS æ„å»º <code>workInProgress</code> &amp; diffï¼Œæ ‡è®°æ‰€æœ‰å˜åŒ–åˆ° <code>flags</code>ï¼Œå¹¶æ±‡æ€»æˆ effect listã€‚</li><li><strong>æäº¤é˜¶æ®µ</strong>ï¼šä¸å¯ä¸­æ–­åœ°éå† effect listï¼Œæ‰§è¡Œ DOM æ“ä½œå’ŒåŒæ­¥å‰¯ä½œç”¨ï¼Œæœ€åè§¦å‘å¼‚æ­¥ <code>useEffect</code>ã€‚</li></ul><p>è¿™æ ·ä¸‰é˜¶æ®µåˆ†ç¦»çš„è®¾è®¡ï¼Œä½¿ React åŒæ—¶å…¼é¡¾äº†æ¸²æŸ“æ€§èƒ½ä¸ UI å“åº”æµç•…æ€§ã€‚</p><p><strong>Fiber æ¶æ„</strong>æ˜¯ React 16 ä»¥åå¼•å…¥çš„ä¸€å¥—æ–°çš„ <strong>åè°ƒï¼ˆReconciliationï¼‰æœºåˆ¶</strong>ï¼Œå®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š</p><blockquote><p><strong>è®©æ¸²æŸ“è¿‡ç¨‹å˜å¾—å¯ä¸­æ–­ã€å¯æ‹†åˆ†ï¼Œå¹¶æ”¯æŒä¼˜å…ˆçº§è°ƒåº¦ï¼Œä»è€Œæå‡ç”¨æˆ·ä½“éªŒã€‚</strong></p></blockquote><p>ä¸ºå®ç°è¿™ä¸ªç›®æ ‡ï¼ŒReact å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ â€”â€” <strong>Fiber æ ‘</strong>ï¼ˆFiber Treeï¼‰ï¼Œå®ƒæ˜¯å¯¹è™šæ‹Ÿ DOM çš„é‡æ–°å®ç°ã€‚</p><hr><h2 id="setstate" tabindex="-1"><a class="header-anchor" href="#setstate"><span>setState</span></a></h2><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Demo2</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#50A14F;--shiki-dark:#E5C07B;"> React</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Component</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    constructor</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">props</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-light-font-style:inherit;--shiki-dark:#E5C07B;--shiki-dark-font-style:italic;">        super</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">props</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">state</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">            count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    handleClick</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        setTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">          this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">          console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">          this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">setState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">          console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    render</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;Demo2&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> onClick</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">handleClick</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">count</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        )</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container important"><p class="hint-container-title">é‡è¦</p><p>ç±»ç»„ä»¶ react18 æ˜¾ç¤ºç»“æœæ˜¯ 0 0 1 1</p><p>react18 æ˜¾ç¤ºç»“æœæ˜¯ 0 0 2 3</p></div><h2 id="ä¸€ã€-usestate-çš„å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€-usestate-çš„å®ç°åŸç†"><span>ä¸€ã€ <code>useState</code> çš„å®ç°åŸç†ï¼Ÿ</span></a></h2><hr><h3 id="âœ…-1-usestate-æ˜¯å¦‚ä½•ä¿å­˜çŠ¶æ€çš„" tabindex="-1"><a class="header-anchor" href="#âœ…-1-usestate-æ˜¯å¦‚ä½•ä¿å­˜çŠ¶æ€çš„"><span>âœ… 1. <strong><code>useState</code> æ˜¯å¦‚ä½•ä¿å­˜çŠ¶æ€çš„ï¼Ÿ</strong></span></a></h3><p>React é€šè¿‡å†…éƒ¨çš„ <strong>Fiber æ•°æ®ç»“æ„</strong> è®°å½•æ¯ä¸ªç»„ä»¶çš„çŠ¶æ€ä¿¡æ¯ã€‚æ¯ä¸ªç»„ä»¶ï¼ˆFiberï¼‰éƒ½æœ‰ä¸€ä¸ª <code>memoizedState</code> å±æ€§ï¼Œå®ƒå­˜å‚¨äº†å½“å‰ç»„ä»¶çš„æ‰€æœ‰ Hook çŠ¶æ€ï¼ˆæ¯”å¦‚ <code>useState</code>, <code>useEffect</code> ç­‰ï¼‰ã€‚</p><p>React ä½¿ç”¨ä¸€ä¸ª <strong>é“¾è¡¨ç»“æ„</strong> ä¾æ¬¡å­˜å‚¨æ¯ä¸ª Hook çš„çŠ¶æ€ï¼Œæ¯æ¬¡æ‰§è¡Œç»„ä»¶æ—¶ï¼Œéƒ½é€šè¿‡å†…éƒ¨çš„ <code>currentHook</code> æŒ‡é’ˆé€ä¸ªæ¢å¤ã€‚</p><hr><h3 id="âœ…-2-usestate-çš„åŸºæœ¬æ‰§è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#âœ…-2-usestate-çš„åŸºæœ¬æ‰§è¡Œæµç¨‹"><span>âœ… 2. <strong><code>useState</code> çš„åŸºæœ¬æ‰§è¡Œæµç¨‹</strong></span></a></h3><ul><li><p>åˆæ¬¡æ¸²æŸ“æ—¶ï¼Œ<code>useState(initialState)</code> ä¼šï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ª Hook å¯¹è±¡ï¼š<code>{ memoizedState: initialState, queue: updateQueue }</code></li><li>å­˜å…¥å½“å‰ Fiber çš„ <code>memoizedState</code> é“¾è¡¨ä¸­ã€‚</li><li>è¿”å› <code>[state, setState]</code></li></ul></li><li><p><code>setState</code> è°ƒç”¨æ—¶ï¼š</p><ul><li>æŠŠæ›´æ–°ï¼ˆå¦‚æ–°å€¼æˆ–å‡½æ•°ï¼‰æ·»åŠ åˆ°æ›´æ–°é˜Ÿåˆ—ä¸­ã€‚</li><li>è§¦å‘è°ƒåº¦æœºåˆ¶ <code>scheduleUpdateOnFiber()</code>ï¼Œæ ‡è®°å½“å‰ç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“ã€‚</li><li>é‡æ–°æ‰§è¡Œç»„ä»¶å‡½æ•°ï¼Œä» <code>memoizedState</code> æ¢å¤çŠ¶æ€é“¾è¡¨ï¼Œé‡æ–°è®¡ç®—æ–°çŠ¶æ€ã€‚</li></ul></li></ul><hr><h3 id="âœ…-3-å¤šæ¬¡-usestate-æ€ä¹ˆåŒºåˆ†" tabindex="-1"><a class="header-anchor" href="#âœ…-3-å¤šæ¬¡-usestate-æ€ä¹ˆåŒºåˆ†"><span>âœ… 3. <strong>å¤šæ¬¡ <code>useState</code> æ€ä¹ˆåŒºåˆ†ï¼Ÿ</strong></span></a></h3><p>React å†…éƒ¨æ˜¯<strong>æŒ‰è°ƒç”¨é¡ºåºåŒºåˆ†</strong>çš„ã€‚å¤šæ¬¡ <code>useState()</code> æ˜¯æŒ‰ç…§é“¾è¡¨ä¾æ¬¡æŒ‚è½½çš„ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶ï¼Œå¿…é¡»ä»¥ç›¸åŒé¡ºåºè°ƒç”¨ Hookï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><hr><h3 id="âœ…-4-ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶è¯­å¥é‡Œç”¨-hook" tabindex="-1"><a class="header-anchor" href="#âœ…-4-ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶è¯­å¥é‡Œç”¨-hook"><span>âœ… 4. <strong>ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶è¯­å¥é‡Œç”¨ Hookï¼Ÿ</strong></span></a></h3><p>å› ä¸ºçŠ¶æ€é“¾è¡¨å¿…é¡»åœ¨ç›¸åŒé¡ºåºä¸Šæ¢å¤ã€‚å¦‚æœä½ åœ¨æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ <code>useState</code>ï¼Œä¸‹ä¸€æ¬¡ render é¡ºåºå°±ä¸ä¸€è‡´äº†ï¼Œä¼šå¯¼è‡´çŠ¶æ€é”™ä¹±ã€‚</p><hr><h2 id="äºŒã€æºç è§’åº¦æ·±å…¥å‰–æ" tabindex="-1"><a class="header-anchor" href="#äºŒã€æºç è§’åº¦æ·±å…¥å‰–æ"><span>äºŒã€æºç è§’åº¦æ·±å…¥å‰–æ</span></a></h2><hr><h3 id="_1-åˆå§‹åŒ–é˜¶æ®µ-é¦–æ¬¡-render" tabindex="-1"><a class="header-anchor" href="#_1-åˆå§‹åŒ–é˜¶æ®µ-é¦–æ¬¡-render"><span>1. åˆå§‹åŒ–é˜¶æ®µï¼ˆé¦–æ¬¡ renderï¼‰</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> mountState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">initialState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> mountWorkInProgressHook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> queue</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    pending</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ç¯çŠ¶é“¾è¡¨çš„ pending update</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    dispatch</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  hook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">memoizedState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> typeof</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> initialState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;function&#39;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;">    ?</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> initialState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;">    :</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> initialState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  hook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">queue</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> dispatch</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dispatch</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> update</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      next</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æ’å…¥åˆ°ç¯çŠ¶é“¾è¡¨ä¸­</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> pending</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pending</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">pending</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">      update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">next</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">      update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">next</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> pending</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">next</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">      pending</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">next</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pending</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // è°ƒåº¦æ›´æ–°</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    scheduleUpdateOnFiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">currentFiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">hook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E06C75;">memoizedState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">dispatch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_2-æ›´æ–°é˜¶æ®µ-re-render" tabindex="-1"><a class="header-anchor" href="#_2-æ›´æ–°é˜¶æ®µ-re-render"><span>2. æ›´æ–°é˜¶æ®µï¼ˆre-renderï¼‰</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> updateState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> updateWorkInProgressHook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> queue</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> baseState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">memoizedState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> pendingQueue</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pending</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">pendingQueue</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pending</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // å¤„ç†æ›´æ–°é˜Ÿåˆ—ï¼ˆç¯çŠ¶é“¾è¡¨è½¬æˆçº¿æ€§ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> firstUpdate</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> pendingQueue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">next</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> update</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> firstUpdate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    do</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> action</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      baseState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> typeof</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;function&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">baseState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      update</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">next</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">update</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> firstUpdate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  hook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">memoizedState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> baseState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">baseState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">queue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#C18401;--shiki-dark:#E06C75;">dispatch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„å›¾è§£" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„å›¾è§£"><span>ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„å›¾è§£</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>FunctionComponent</span></span>
<span class="line"><span>  â””â”€â”€ fiber.memoizedState â†’ Hook1 â†’ Hook2 â†’ ...</span></span>
<span class="line"><span>                         (useState) (useEffect)</span></span>
<span class="line"><span>                                â†‘</span></span>
<span class="line"><span>                              queue (æœ‰æ›´æ–°é˜Ÿåˆ—)</span></span>
<span class="line"><span>                                â†‘</span></span>
<span class="line"><span>                            dispatch()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="å››ã€ä½ å¯ä»¥æåˆ°çš„è¡¥å……ç‚¹-åŠ åˆ†" tabindex="-1"><a class="header-anchor" href="#å››ã€ä½ å¯ä»¥æåˆ°çš„è¡¥å……ç‚¹-åŠ åˆ†"><span>å››ã€ä½ å¯ä»¥æåˆ°çš„è¡¥å……ç‚¹ï¼ˆåŠ åˆ†ï¼‰</span></a></h2><ul><li><code>useReducer</code> å®é™…ä¸Šä¸ <code>useState</code> å…±äº«åº•å±‚å®ç°ï¼Œå·®å¼‚åªæ˜¯ reducer vs. direct valueã€‚</li><li>Hook æœ¬è´¨æ˜¯åŸºäºé—­åŒ…ã€é“¾è¡¨å’Œè°ƒåº¦æ§åˆ¶çš„ç»„åˆã€‚</li><li>React å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œ setStateï¼Œè€Œæ˜¯é€šè¿‡è°ƒåº¦å™¨æ§åˆ¶æ›´æ–°èŠ‚å¥ï¼ˆæ—¶é—´åˆ‡ç‰‡ã€ä¼˜å…ˆçº§ï¼‰ã€‚</li></ul><hr><h2 id="æ€»ç»“ä¸€å¥è¯å›ç­”-ç²¾ç®€ç‰ˆ" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“ä¸€å¥è¯å›ç­”-ç²¾ç®€ç‰ˆ"><span>æ€»ç»“ä¸€å¥è¯å›ç­”ï¼ˆç²¾ç®€ç‰ˆï¼‰ï¼š</span></a></h2><blockquote><p><code>useState</code> ä¼šæŠŠçŠ¶æ€ä¿å­˜åˆ°å½“å‰ Fiber çš„ Hook é“¾è¡¨ä¸­ï¼Œå¹¶é€šè¿‡ <code>setState</code> å°†æ›´æ–°åŠ å…¥é˜Ÿåˆ—ï¼Œå†è§¦å‘è°ƒåº¦é‡æ–°æ¸²æŸ“ã€‚å¤šä¸ª Hook æ˜¯æŒ‰é¡ºåºç»‘å®šçš„ï¼Œå¿…é¡»ç¨³å®šè°ƒç”¨é¡ºåºã€‚</p></blockquote><hr><h2 id="ğŸ§ -ä¸€ã€useeffect-å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -ä¸€ã€useeffect-å®ç°åŸç†"><span>ğŸ§  ä¸€ã€<code>useEffect</code> å®ç°åŸç†ï¼Ÿ</span></a></h2><hr><h3 id="âœ…-1-useeffect-çŠ¶æ€çš„ä¿å­˜æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#âœ…-1-useeffect-çŠ¶æ€çš„ä¿å­˜æœºåˆ¶"><span>âœ… 1. <code>useEffect</code> çŠ¶æ€çš„ä¿å­˜æœºåˆ¶</span></a></h3><p>React ä¼šåœ¨æ¯ä¸ªå‡½æ•°ç»„ä»¶çš„ Fiber ä¸Šç»´æŠ¤ä¸€ä¸ª <code>memoizedState</code> é“¾è¡¨ï¼Œæ¯æ¬¡è°ƒç”¨ <code>useEffect</code>ï¼Œéƒ½ä¼šåœ¨é“¾è¡¨ä¸­æ³¨å†Œä¸€ä¸ª Hook å¯¹è±¡ï¼š</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">  memoizedState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    deps</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">],          </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ä¸Šä¸€æ¬¡çš„ä¾èµ–</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: () </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¿™æ¬¡ä¼ å…¥çš„ effect å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    destroy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: () </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   // ä¸Šæ¬¡çš„æ¸…ç†å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="âœ…-2-useeffect-ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#âœ…-2-useeffect-ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ"><span>âœ… 2. <code>useEffect</code> ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ</span></a></h3><ul><li><strong>æ‰§è¡Œæ—¶æœº</strong>ï¼šæ˜¯åœ¨ <strong>æµè§ˆå™¨ç»˜åˆ¶ä¹‹åå¼‚æ­¥æ‰§è¡Œï¼ˆéé˜»å¡ UIï¼‰</strong>ï¼Œå¤§è‡´ç­‰ä»·äº <code>componentDidMount</code> å’Œ <code>componentDidUpdate</code>ã€‚</li><li>æ˜¯åœ¨ commit é˜¶æ®µä¹‹åç»Ÿä¸€è°ƒåº¦æ‰§è¡Œçš„ï¼ˆ<strong>å‰¯ä½œç”¨é˜¶æ®µ</strong>ï¼‰ã€‚</li></ul><hr><h3 id="âœ…-3-useeffect-æ˜¯æ€ä¹ˆçŸ¥é“ä¾èµ–å˜åŒ–çš„" tabindex="-1"><a class="header-anchor" href="#âœ…-3-useeffect-æ˜¯æ€ä¹ˆçŸ¥é“ä¾èµ–å˜åŒ–çš„"><span>âœ… 3. <code>useEffect</code> æ˜¯æ€ä¹ˆçŸ¥é“ä¾èµ–å˜åŒ–çš„ï¼Ÿ</span></a></h3><p>æ¯æ¬¡æ›´æ–°æ—¶ï¼ŒReact ä¼šæŠŠæœ¬æ¬¡çš„ <code>deps</code> å’Œä¸Šä¸€æ¬¡ä¿å­˜åœ¨ Hook ä¸­çš„ <code>deps</code> åš <strong>æµ…å¯¹æ¯”ï¼ˆ<a href="http://Object.is" target="_blank" rel="noopener noreferrer">Object.is</a>ï¼‰</strong>ï¼š</p><ul><li><p>å¦‚æœæ²¡å˜ï¼Œåˆ™è·³è¿‡æ‰§è¡Œï¼›</p></li><li><p>å¦‚æœæœ‰å˜ï¼š</p><ul><li>æ‰§è¡Œä¸Šæ¬¡çš„ <code>destroy()</code> æ¸…ç†å‡½æ•°ï¼ˆå¦‚æœæœ‰ï¼‰ï¼›</li><li>æ‰§è¡Œæ–°çš„ <code>create()</code> å‡½æ•°ï¼Œå¹¶å°†å…¶è¿”å›çš„æ¸…ç†å‡½æ•°ä¿ç•™ä¸‹æ¥ã€‚</li></ul></li></ul><hr><h3 id="âœ…-4-ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶ä¸­ä½¿ç”¨-useeffect" tabindex="-1"><a class="header-anchor" href="#âœ…-4-ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶ä¸­ä½¿ç”¨-useeffect"><span>âœ… 4. ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶ä¸­ä½¿ç”¨ <code>useEffect</code>ï¼Ÿ</span></a></h3><p>å› ä¸º React æ˜¯é€šè¿‡<strong>è°ƒç”¨é¡ºåº</strong>æ¥åŒ¹é… Hook çš„çŠ¶æ€ï¼Œæ¡ä»¶ä¸­ä½¿ç”¨ä¼šç ´åé¡ºåºï¼Œå¯¼è‡´ <code>deps</code> é”™é…æˆ–å¼‚å¸¸è¡Œä¸ºã€‚</p><hr><h2 id="ğŸ§©-äºŒã€æºç å±‚é¢ç®€åŒ–è§£æ" tabindex="-1"><a class="header-anchor" href="#ğŸ§©-äºŒã€æºç å±‚é¢ç®€åŒ–è§£æ"><span>ğŸ§© äºŒã€æºç å±‚é¢ç®€åŒ–è§£æ</span></a></h2><p>React å¯¹ <code>useEffect</code> çš„å¤„ç†ä¸»è¦åœ¨ä¸¤ä¸ªé˜¶æ®µï¼š</p><hr><h3 id="ğŸ”§-1-render-é˜¶æ®µæ³¨å†Œ-effect" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-1-render-é˜¶æ®µæ³¨å†Œ-effect"><span>ğŸ”§ 1. render é˜¶æ®µæ³¨å†Œ effectï¼š</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> mountEffect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">deps</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> hook</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> mountWorkInProgressHook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> effect</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    tag</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> Passive</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,       </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// è¡¨ç¤º useEffect</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,             </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å‰¯ä½œç”¨å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    destroy</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> undefined</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ¸…ç†å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    deps</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                // ä¾èµ–é¡¹</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  hook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">memoizedState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> effect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // å°† effect å­˜å…¥ fiber çš„ effect é“¾è¡¨</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  pushEffect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">effect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ›´æ–°æ—¶è°ƒç”¨ <code>updateEffect</code>ï¼Œå…¶ä¸­åšä¾èµ–é¡¹çš„å¯¹æ¯”ã€‚</p></blockquote><hr><h3 id="ğŸ”„-2-commit-é˜¶æ®µæ‰§è¡Œ-effect" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-2-commit-é˜¶æ®µæ‰§è¡Œ-effect"><span>ğŸ”„ 2. commit é˜¶æ®µæ‰§è¡Œ effectï¼š</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> commitPassiveEffects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">fiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // éå† fiber çš„ effect é“¾è¡¨</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> effect</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> of</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> fiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">updateQueue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">effects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æœ‰æ¸…ç†å‡½æ•°å°±å…ˆæ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> effect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">destroy</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;function&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">      effect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">destroy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // æ‰§è¡Œå‰¯ä½œç”¨ï¼Œä¿å­˜æ–°çš„æ¸…ç†å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> destroy</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> effect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    effect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">destroy</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> typeof</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> destroy</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;function&#39;</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> destroy</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> undefined</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº› effect æ˜¯åœ¨ <strong>å¼‚æ­¥è°ƒåº¦çš„ effect flushing é˜¶æ®µ</strong> æ‰§è¡Œçš„ï¼Œç¡®ä¿ä¸ä¼šé˜»å¡æ¸²æŸ“ã€‚</p><hr><h2 id="ğŸ”„-ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„ç¤ºæ„å›¾" tabindex="-1"><a class="header-anchor" href="#ğŸ”„-ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„ç¤ºæ„å›¾"><span>ğŸ”„ ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„ç¤ºæ„å›¾</span></a></h2><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">FunctionComponent</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  â””â”€ </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">memoizedState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Hook1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">useState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) â†’ </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Hook2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">useEffect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) â†’ </span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                â†“</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">                   Hook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">memoizedState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">                     deps</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">                     create</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> fn</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">                     destroy</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> fn</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> |</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> undefined</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                   }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ğŸ’¡-å››ã€ç®€ç‰ˆæ€»ç»“å›ç­”-é€‚åˆé¢è¯•" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-å››ã€ç®€ç‰ˆæ€»ç»“å›ç­”-é€‚åˆé¢è¯•"><span>ğŸ’¡ å››ã€ç®€ç‰ˆæ€»ç»“å›ç­”ï¼ˆé€‚åˆé¢è¯•ï¼‰</span></a></h2><blockquote><p><code>useEffect</code> ä¼šåœ¨ç»„ä»¶æ¸²æŸ“åå¼‚æ­¥æ‰§è¡Œï¼ŒReact å†…éƒ¨å°†å…¶æ³¨å†Œä¸ºä¸€ä¸ªå‰¯ä½œç”¨ï¼ˆeffectï¼‰å¯¹è±¡ï¼Œä¿å­˜äº Hook é“¾è¡¨ä¸­ï¼Œåœ¨ commit é˜¶æ®µç»Ÿä¸€è°ƒåº¦æ‰§è¡Œã€‚é€šè¿‡å¯¹æ¯”å½“å‰ä¾èµ–å’Œä¸Šä¸€æ¬¡ä¾èµ–å†³å®šæ˜¯å¦é‡æ–°æ‰§è¡Œï¼Œå¹¶æ”¯æŒè¿”å›æ¸…ç†å‡½æ•°å¤„ç†å‰¯ä½œç”¨æ¸…ç†ã€‚</p></blockquote><hr><h2 id="ğŸ› -äº”ã€è¿›é˜¶è¡¥å……-åŠ åˆ†é¡¹" tabindex="-1"><a class="header-anchor" href="#ğŸ› -äº”ã€è¿›é˜¶è¡¥å……-åŠ åˆ†é¡¹"><span>ğŸ›  äº”ã€è¿›é˜¶è¡¥å……ï¼ˆåŠ åˆ†é¡¹ï¼‰</span></a></h2><ul><li><code>useLayoutEffect</code> ä¸ <code>useEffect</code> ä¸åŒï¼šå®ƒåœ¨ DOM å˜æ›´ååŒæ­¥æ‰§è¡Œï¼Œé˜»å¡ç»˜åˆ¶ã€‚</li><li><code>useInsertionEffect</code> æ˜¯åœ¨ React DOM commit å‰æ³¨å…¥ CSS çš„ï¼ˆå¦‚ styled-componentsï¼‰ã€‚</li><li>React 18 å¼€å§‹ï¼Œeffect çš„æ‰§è¡Œæœ‰è°ƒåº¦ä¼˜å…ˆçº§å½±å“ï¼Œç»“åˆè°ƒåº¦å™¨ã€‚</li></ul><hr><h2 id="ğŸ§ -suspense-æ ¸å¿ƒåŸç†ä¸€å¥è¯æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -suspense-æ ¸å¿ƒåŸç†ä¸€å¥è¯æ€»ç»“"><span>ğŸ§  Suspense æ ¸å¿ƒåŸç†ä¸€å¥è¯æ€»ç»“ï¼š</span></a></h2><blockquote><p><strong>React æ•æ‰åˆ°ç»„ä»¶æŠ›å‡ºçš„ Promiseï¼Œåˆ‡æ¢åˆ° fallbackï¼Œç­‰ Promise resolve åå†é‡æ–°æ¸²æŸ“ã€‚</strong></p></blockquote><hr><h2 id="âœ…-å®ç°æœºåˆ¶åˆ†ä¸‰æ­¥" tabindex="-1"><a class="header-anchor" href="#âœ…-å®ç°æœºåˆ¶åˆ†ä¸‰æ­¥"><span>âœ… å®ç°æœºåˆ¶åˆ†ä¸‰æ­¥ï¼š</span></a></h2><h3 id="_1-react-lazy-è¿”å›çš„æ˜¯ä¸€ä¸ª-æ‡’åŠ è½½ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_1-react-lazy-è¿”å›çš„æ˜¯ä¸€ä¸ª-æ‡’åŠ è½½ç»„ä»¶"><span>1. <code>React.lazy()</code> è¿”å›çš„æ˜¯ä¸€ä¸ªâ€œæ‡’åŠ è½½ç»„ä»¶â€</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> MyComponent</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> React</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lazy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#0184BC;--shiki-dark:#61AFEF;"> import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;./MyComponent&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸ªæ‡’åŠ è½½ç»„ä»¶åœ¨åˆæ¬¡æ¸²æŸ“æ—¶ä¸ä¼šç›´æ¥è¿”å›ç»„ä»¶ï¼Œè€Œæ˜¯æŠ›å‡ºä¸€ä¸ª Promise ç»™ Reactã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å†…éƒ¨ç±»ä¼¼è¿™æ ·</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> lazy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">loader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;pending&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// &#39;pending&#39; | &#39;fulfilled&#39; | &#39;rejected&#39;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> thenable</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> loader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    module</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;fulfilled&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      result</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> module</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">default</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    err</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;rejected&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      result</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> err</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> LazyComponent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">props</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;pending&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> thenable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ğŸš¨ æŠ›å‡º Promiseï¼ŒReact ä¼šæ•è·</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;rejected&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;   </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// ğŸš¨ æŠ›å‡º Errorï¼Œèµ° ErrorBoundary</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> React</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createElement</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">props</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  };</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_2-suspense-fallback-æ•è·-å¼‚å¸¸æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#_2-suspense-fallback-æ•è·-å¼‚å¸¸æ¸²æŸ“"><span>2. <code>&lt;Suspense fallback&gt;</code> æ•è·â€œå¼‚å¸¸æ¸²æŸ“â€</span></a></h3><p>å½“ <code>LazyComponent</code> æŠ›å‡º Promiseï¼ŒReact è¿›å…¥â€œ<strong>æŒ‚èµ·çŠ¶æ€</strong>â€ï¼Œå®ƒä¼šæŸ¥æ‰¾æœ€è¿‘çš„ <code>&lt;Suspense&gt;</code> æ¥æ˜¾ç¤º fallbackã€‚</p><p>React å†…éƒ¨é€šè¿‡ try/catch æ•æ‰è¿™ä¸ª Promiseï¼Œç„¶åæ³¨å†Œ <code>.then()</code>ï¼Œå½“å…¶ resolve åï¼Œé‡æ–°å‘èµ·ä¸€æ¬¡æ¸²æŸ“ã€‚</p><blockquote><p><strong>æ³¨æ„ï¼šä¸æ˜¯ error æ˜¯ promiseï¼ŒReact æ˜¯é€šè¿‡åˆ¤æ–­ thrown çš„å€¼æ˜¯ Promise æ¥è¿›å…¥ suspend æ¨¡å¼çš„ã€‚</strong></p></blockquote><hr><h3 id="_3-å¼‚æ­¥å®Œæˆåé‡æ–°æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#_3-å¼‚æ­¥å®Œæˆåé‡æ–°æ¸²æŸ“"><span>3. å¼‚æ­¥å®Œæˆåé‡æ–°æ¸²æŸ“</span></a></h3><p>å½“ Promise resolveï¼ŒReact å°±ä¼šæ¢å¤ç»„ä»¶æ ‘æ¸²æŸ“æµç¨‹ï¼Œå¹¶æ­£å¸¸æ˜¾ç¤ºç»„ä»¶ã€‚</p><hr><h2 id="ğŸ–¼ï¸-æµç¨‹å›¾ç®€åŒ–" tabindex="-1"><a class="header-anchor" href="#ğŸ–¼ï¸-æµç¨‹å›¾ç®€åŒ–"><span>ğŸ–¼ï¸ æµç¨‹å›¾ç®€åŒ–ï¼š</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>  function App() {</span></span>
<span class="line"><span>    return (</span></span>
<span class="line"><span>      &lt;Suspense fallback={&lt;div&gt;Loading...&lt;/div&gt;}&gt;</span></span>
<span class="line"><span>        &lt;LazyComponent /&gt;</span></span>
<span class="line"><span>      &lt;/Suspense&gt;</span></span>
<span class="line"><span>    );</span></span>
<span class="line"><span>  }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â¡ï¸ æ¸²æŸ“ LazyComponent<br> â€ƒâ€ƒâ¡ï¸ æŠ›å‡º Promise<br> â€ƒâ€ƒâ¡ï¸ React æ•è·<br> â€ƒâ€ƒâ¡ï¸ æ˜¾ç¤º fallback<br> â€ƒâ€ƒâ¡ï¸ Promise resolve å<br> â€ƒâ€ƒâ¡ï¸ è‡ªåŠ¨é‡æ–°æ¸²æŸ“ LazyComponent</p><hr><h2 id="ğŸ§ª-ç±»æ¯”" tabindex="-1"><a class="header-anchor" href="#ğŸ§ª-ç±»æ¯”"><span>ğŸ§ª ç±»æ¯”ï¼š</span></a></h2><p>å¯ä»¥å°† Suspense çœ‹ä½œæ˜¯ä¸€ä¸ªâ€œtry-catch + loading æ³¨å†Œå™¨â€ï¼Œé‡åˆ° <code>throw Promise</code> æ—¶å®ƒå°±ï¼š</p><ul><li>catch ä½</li><li>ç­‰ Promise resolve</li><li>ç„¶åé‡æ–°æ¸²æŸ“è¯¥éƒ¨åˆ†ç»„ä»¶æ ‘</li></ul><hr><h2 id="ğŸ“¦-é™¤äº†-lazy-è°è¿˜èƒ½ç”¨-suspense" tabindex="-1"><a class="header-anchor" href="#ğŸ“¦-é™¤äº†-lazy-è°è¿˜èƒ½ç”¨-suspense"><span>ğŸ“¦ é™¤äº† lazyï¼Œè°è¿˜èƒ½ç”¨ Suspenseï¼Ÿ</span></a></h2><p>é™¤äº† <code>React.lazy()</code>ï¼Œåªè¦æœ‰ç»„ä»¶èƒ½ <strong>throw ä¸€ä¸ª Promise</strong>ï¼Œå°±èƒ½æŒ‚èµ·æ¸²æŸ“ã€‚å¸¸è§çš„åº”ç”¨åŒ…æ‹¬ï¼š</p><ul><li>âš›ï¸ <code>react-router</code> çš„æ‡’åŠ è½½è·¯ç”±ç»„ä»¶</li><li>âš›ï¸ <code>React Server Components</code></li><li>âš›ï¸ <code>Relay</code> ç­‰æ•°æ®æŠ“å–åº“</li><li>âš›ï¸ ä½ è‡ªå·±å†™çš„ç»„ä»¶ä¸­ <code>throw fetchData()</code> ä¹Ÿèƒ½ç”¨ï¼ˆé…åˆ <code>suspense: true</code>ï¼‰</li></ul><hr><h2 id="âœ…-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#âœ…-æ€»ç»“"><span>âœ… æ€»ç»“</span></a></h2><table><thead><tr><th>ç‚¹</th><th>å†…å®¹</th></tr></thead><tbody><tr><td><strong>æœ¬è´¨</strong></td><td>é€šè¿‡ <code>throw Promise</code> æš‚åœæ¸²æŸ“</td></tr><tr><td><strong>ç”¨é€”</strong></td><td>å¼‚æ­¥ç»„ä»¶ã€æ•°æ®åŠ è½½ã€æ‡’åŠ è½½</td></tr><tr><td><strong>fallback è§¦å‘æ¡ä»¶</strong></td><td>å½“å‰ç»„ä»¶æ ‘å†…æŸç»„ä»¶æŠ›å‡º Promise</td></tr><tr><td><strong>æ¢å¤æ¡ä»¶</strong></td><td>Promise resolve åï¼ŒReact è‡ªåŠ¨é‡æ–°æ¸²æŸ“</td></tr><tr><td><strong>ä¾èµ–</strong></td><td><code>React.lazy()</code> æˆ–å…¶ä»–æŠ›å‡º Promise çš„ç»„ä»¶</td></tr></tbody></table><hr><h2 id="âœ…-ç®€åŒ–ç‰ˆ-react-lazy-suspense-å®ç°" tabindex="-1"><a class="header-anchor" href="#âœ…-ç®€åŒ–ç‰ˆ-react-lazy-suspense-å®ç°"><span>âœ… ç®€åŒ–ç‰ˆ <code>React.lazy</code> + <code>Suspense</code> å®ç°</span></a></h2><p>æˆ‘ä»¬ä¸å®ç° Fiberï¼Œä»…ç”¨ã€ŒåŒæ­¥æ¸²æŸ“ + try/catch + Promiseã€æ¨¡æ‹Ÿ React çš„æ ¸å¿ƒè¡Œä¸ºã€‚</p><h3 id="_1ï¸âƒ£-lazy-æ¨¡æ‹Ÿç‰ˆ" tabindex="-1"><a class="header-anchor" href="#_1ï¸âƒ£-lazy-æ¨¡æ‹Ÿç‰ˆ"><span>1ï¸âƒ£ <code>lazy</code> æ¨¡æ‹Ÿç‰ˆ</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> lazy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">loader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;pending&#39;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> result</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> promise</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> loader</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    mod</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;fulfilled&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      result</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> mod</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">default</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    err</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;rejected&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">      result</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> err</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> LazyComponent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">props</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;pending&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> promise</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">status</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;rejected&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> result</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">props</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ï¸âƒ£-ç®€åŒ–ç‰ˆ-suspense-å®ç°" tabindex="-1"><a class="header-anchor" href="#_2ï¸âƒ£-ç®€åŒ–ç‰ˆ-suspense-å®ç°"><span>2ï¸âƒ£ ç®€åŒ–ç‰ˆ <code>Suspense</code> å®ç°</span></a></h3><p>æˆ‘ä»¬å†™ä¸€ä¸ªæ¨¡æ‹Ÿã€ŒæŒ‚èµ·æ•è·ã€é€»è¾‘çš„æ¸²æŸ“å‡½æ•°ï¼š</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> render</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">fallback</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;âœ… æ¸²æŸ“å®Œæˆ:&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">then</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;function&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;ğŸ•’ æ•è· Promiseï¼Œæ˜¾ç¤º fallback&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">      e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;ğŸ”„ Promise resolvedï¼Œé‡æ–°æ¸²æŸ“&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        render</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">fallback</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;âŒ æŠ¥é”™:&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ï¸âƒ£-æµ‹è¯•-å»¶è¿Ÿç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_3ï¸âƒ£-æµ‹è¯•-å»¶è¿Ÿç»„ä»¶"><span>3ï¸âƒ£ æµ‹è¯•ï¼šå»¶è¿Ÿç»„ä»¶</span></a></h3><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> LazyHello</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> lazy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  new</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    setTimeout</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      resolve</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">        default</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;Hello from lazy component!&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> LazyHello</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¼€å§‹æ¸²æŸ“</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">render</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;Loading...&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="âœ…-è¾“å‡ºç»“æœ" tabindex="-1"><a class="header-anchor" href="#âœ…-è¾“å‡ºç»“æœ"><span>âœ… è¾“å‡ºç»“æœï¼š</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ğŸ•’ æ•è· Promiseï¼Œæ˜¾ç¤º fallback</span></span>
<span class="line"><span>ğŸ”„ Promise resolvedï¼Œé‡æ–°æ¸²æŸ“</span></span>
<span class="line"><span>âœ… æ¸²æŸ“å®Œæˆ: Hello from lazy component!</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ğŸ“š-react-æºç å±‚é¢-å¦‚ä½•çœŸæ­£å®ç°æŒ‚èµ·" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-react-æºç å±‚é¢-å¦‚ä½•çœŸæ­£å®ç°æŒ‚èµ·"><span>ğŸ“š React æºç å±‚é¢ï¼šå¦‚ä½•çœŸæ­£å®ç°æŒ‚èµ·ï¼Ÿ</span></a></h2><p>ä»¥ä¸‹æ˜¯ React 18 ä¸­çš„çœŸå®å¤„ç†ï¼š</p><h3 id="_1-ç»„ä»¶æŠ›å‡º-promise-çš„æ—¶å€™" tabindex="-1"><a class="header-anchor" href="#_1-ç»„ä»¶æŠ›å‡º-promise-çš„æ—¶å€™"><span>1. ç»„ä»¶æŠ›å‡º Promise çš„æ—¶å€™</span></a></h3><p>åœ¨ <code>beginWork</code> é˜¶æ®µè°ƒç”¨ç»„ä»¶ï¼ˆå¦‚å‡½æ•°ç»„ä»¶ï¼‰æ—¶ï¼š</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> Component</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> workInProgress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">type</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> value</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Component</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">props</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// âš ï¸ æŠ›å‡º Promise</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>React æ•è·åˆ°å¼‚å¸¸ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æ˜¯ thenableï¼š</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> thrownValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">then</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;function&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // æŒ‚èµ·é€»è¾‘èµ°è¿™é‡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  attachPingListener</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">thrownValue</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  throw</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> thrownValue</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> // å†æ¬¡æŠ›å‡ºç»™ä¸Šå±‚ Suspense æ•æ‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-suspense-è¾ƒè¿‘è¾¹ç•Œæ‹¦æˆªå®ƒ" tabindex="-1"><a class="header-anchor" href="#_2-suspense-è¾ƒè¿‘è¾¹ç•Œæ‹¦æˆªå®ƒ"><span>2. Suspense è¾ƒè¿‘è¾¹ç•Œæ‹¦æˆªå®ƒ</span></a></h3><p>React ä¼šæŸ¥æ‰¾ã€Œæœ€è¿‘çš„ Suspense ç»„ä»¶ Fiberã€ï¼Œè®°å½•ä¸‹æ¥å¹¶æ›¿æ¢ä¸º fallback æ ‘ã€‚</p><p>ç›¸å…³ä»£ç åœ¨ï¼š</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>packages/react-reconciler/src/ReactFiberThrow.js</span></span>
<span class="line"><span>â†’ throwException()</span></span>
<span class="line"><span>â†’ handleException()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-promise-resolve-åçš„-ping-æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_3-promise-resolve-åçš„-ping-æœºåˆ¶"><span>3. Promise resolve åçš„ ping æœºåˆ¶</span></a></h3><p>æ¯ä¸€ä¸ª Promiseï¼ˆä¹Ÿå°±æ˜¯ <code>thenable</code>ï¼‰éƒ½ä¼šè¢«æ³¨å†Œä¸€ä¸ªç›‘å¬å›è°ƒï¼ˆå« <code>pingCache</code>ï¼‰ï¼Œå›è°ƒä¼šè§¦å‘ root çš„ <code>performConcurrentWorkOnRoot</code>ï¼Œé‡æ–°è¿›å…¥æ¸²æŸ“æµç¨‹ã€‚</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> attachPingListener</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">thenable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> ping</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">pingCache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">delete</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">thenable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    scheduleUpdateOnFiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  thenable</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">ping</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ğŸ§ -memoizedstate-æ˜¯æ€ä¹ˆé…åˆçš„" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -memoizedstate-æ˜¯æ€ä¹ˆé…åˆçš„"><span>ğŸ§  memoizedState æ˜¯æ€ä¹ˆé…åˆçš„ï¼Ÿ</span></a></h2><p>åœ¨æŒ‚èµ·æ—¶ï¼ŒReact ä¼šå°† Suspense çš„ fallback èŠ‚ç‚¹å­˜åœ¨è¯¥ Fiber çš„ <code>memoizedState</code> ä¸Šï¼š</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">memoizedState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  dehydrated</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  retryLane</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> lane</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªçŠ¶æ€ç”¨æ¥æ ‡è®°ï¼š</p><ul><li>å½“å‰æ˜¯å¦å¤„äºæŒ‚èµ·çŠ¶æ€ï¼ˆæ˜¯å¦æ­£åœ¨æ˜¾ç¤º fallbackï¼‰</li><li>æ¢å¤æ—¶æ˜¯å¦è¿˜éœ€è¦ç»§ç»­ retry</li></ul><hr><h2 id="âœ…-æ€»ç»“-1" tabindex="-1"><a class="header-anchor" href="#âœ…-æ€»ç»“-1"><span>âœ… æ€»ç»“</span></a></h2><table><thead><tr><th>ç‚¹</th><th>å†…å®¹</th></tr></thead><tbody><tr><td><code>React.lazy</code></td><td>è¿”å›ç»„ä»¶æ—¶æ ¹æ®åŠ è½½çŠ¶æ€å†³å®šæ˜¯å¦æŠ›å‡º Promise</td></tr><tr><td><code>Suspense</code></td><td>æ•è· Promiseï¼Œæ›¿æ¢å­æ ‘ä¸º fallbackï¼Œç­‰ Promise resolve</td></tr><tr><td>å¼‚æ­¥æ¢å¤</td><td>æ³¨å†Œ ping ç›‘å¬å™¨ï¼ŒPromise resolve åé‡æ–°æ¸²æŸ“</td></tr><tr><td><code>memoizedState</code></td><td>å­˜å‚¨ fallback æ˜¾ç¤ºçŠ¶æ€ï¼Œé¿å…å¤šæ¬¡åˆ‡æ¢</td></tr><tr><td>å…³é”®ä»£ç </td><td><code>throwException</code>, <code>attachPingListener</code>, <code>SuspenseComponent</code> çš„ beginWork å’Œ completeWork</td></tr></tbody></table><hr><h2 id="react-è·¯ç”±" tabindex="-1"><a class="header-anchor" href="#react-è·¯ç”±"><span>react è·¯ç”±</span></a></h2><h2 id="react-router" tabindex="-1"><a class="header-anchor" href="#react-router"><span>React Router</span></a></h2><blockquote><p>React Router æ˜¯ä¸€ä¸ªé€šè¿‡ç›‘å¬ URL å˜åŒ–ï¼ˆ<code>history</code> æˆ– <code>hash</code>ï¼‰ï¼Œåˆ©ç”¨ React çš„ç»„ä»¶æ¸²æŸ“æœºåˆ¶æ¥åŒ¹é…å¯¹åº”çš„è·¯ç”±ç»„ä»¶ï¼Œä»è€Œå®ç°é¡µé¢å†…å®¹çš„åŠ¨æ€åˆ‡æ¢çš„å®¢æˆ·ç«¯è·¯ç”±æ–¹æ¡ˆã€‚</p></blockquote><hr><h3 id="_1-url-å˜åŒ–ç›‘å¬" tabindex="-1"><a class="header-anchor" href="#_1-url-å˜åŒ–ç›‘å¬"><span>1. <strong>URL å˜åŒ–ç›‘å¬</strong></span></a></h3><p>React Router æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><table><thead><tr><th>è·¯ç”±æ¨¡å¼</th><th>å®ç°æ–¹å¼</th></tr></thead><tbody><tr><td>BrowserRouter</td><td>ä½¿ç”¨ HTML5 çš„ <code>history.pushState</code> å’Œ <code>popstate</code> äº‹ä»¶</td></tr><tr><td>HashRouter</td><td>ä½¿ç”¨ URL ä¸­çš„ <code>#</code> å·å’Œ <code>hashchange</code> äº‹ä»¶</td></tr></tbody></table><p>è¿™ä¸¤ä¸ªæ¨¡å¼éƒ½å¯ä»¥å®ç°ã€ŒURL æ”¹å˜ä½†é¡µé¢ä¸åˆ·æ–°ã€ã€‚</p><hr><h3 id="_2-history-å¯¹è±¡çš„å°è£…" tabindex="-1"><a class="header-anchor" href="#_2-history-å¯¹è±¡çš„å°è£…"><span>2. <strong>history å¯¹è±¡çš„å°è£…</strong></span></a></h3><p>React Router åº•å±‚ä¾èµ– <a href="https://github.com/remix-run/history" target="_blank" rel="noopener noreferrer"><code>history</code></a> åº“ï¼Œå®ƒå°è£…äº†æµè§ˆå™¨åŸç”Ÿçš„ <code>history</code> APIï¼Œæä¾›äº†ç»Ÿä¸€çš„ç¼–ç¨‹æ¥å£ï¼š</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> history</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createBrowserHistory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">history</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;/about&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ”¹å˜è·¯å¾„ï¼Œä¸åˆ·æ–°é¡µé¢</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_3-router-context-æä¾›å½“å‰-location" tabindex="-1"><a class="header-anchor" href="#_3-router-context-æä¾›å½“å‰-location"><span>3. <strong>Router Context æä¾›å½“å‰ location</strong></span></a></h3><p>React Router ä½¿ç”¨ä¸€ä¸ª <code>RouterContext</code>ï¼Œé€šè¿‡ React çš„ Context API å…¨å±€æä¾›å½“å‰è·¯ç”±çŠ¶æ€ï¼š</p><div class="language-tsx line-numbers-mode" data-highlighter="shiki" data-ext="tsx" data-title="tsx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> routerContext</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;"> React</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">createContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RouterContext.Provider</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">={{ location, navigate }}&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">  {</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">&lt;/RouterContext.Provider&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ <code>&lt;Route&gt;</code>ï¼‰é€šè¿‡ <code>useContext(RouterContext)</code> è·å–å½“å‰è·¯å¾„ä¿¡æ¯ï¼Œå®ç°åŒ¹é…ä¸æ¸²æŸ“ã€‚</p><hr><h3 id="_4-è·¯ç”±åŒ¹é…åŸç†-é€’å½’åŒ¹é…" tabindex="-1"><a class="header-anchor" href="#_4-è·¯ç”±åŒ¹é…åŸç†-é€’å½’åŒ¹é…"><span>4. <strong>è·¯ç”±åŒ¹é…åŸç†ï¼ˆé€’å½’åŒ¹é…ï¼‰</strong></span></a></h3><p>React Router ä¼šå°†å®šä¹‰å¥½çš„ routesï¼ˆé€šå¸¸æ˜¯æ ‘å½¢ç»“æ„ï¼‰ï¼Œå’Œå½“å‰çš„ location.pathname è¿›è¡Œ<strong>é€’å½’åŒ¹é…</strong>ï¼Œæ‰¾åˆ°æœ€åŒ¹é…çš„ <code>Route</code> å¹¶æ¸²æŸ“å®ƒã€‚</p><p>æºç æ ¸å¿ƒæ–¹æ³•ä¸º <code>matchRoutes(routes, location.pathname)</code>ã€‚</p><hr><h3 id="_5-åŠ¨æ€æ¸²æŸ“ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_5-åŠ¨æ€æ¸²æŸ“ç»„ä»¶"><span>5. <strong>åŠ¨æ€æ¸²æŸ“ç»„ä»¶</strong></span></a></h3><p>è·¯ç”±åŒ¹é…æˆåŠŸåï¼Œä¼šé€šè¿‡ <code>&lt;Outlet&gt;</code> å’Œ <code>&lt;useRoutes&gt;</code> ç­‰ API åŠ¨æ€æ¸²æŸ“ç»„ä»¶ï¼š</p><div class="language-tsx line-numbers-mode" data-highlighter="shiki" data-ext="tsx" data-title="tsx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> element</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> useRoutes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">([</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  { </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;/&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">element</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Home</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt; },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  { </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;/about&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">element</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">About</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt; },</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="äºŒã€æ•´ä½“æµç¨‹å›¾ç¤º-ç®€åŒ–ç‰ˆ" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ•´ä½“æµç¨‹å›¾ç¤º-ç®€åŒ–ç‰ˆ"><span>äºŒã€æ•´ä½“æµç¨‹å›¾ç¤ºï¼ˆç®€åŒ–ç‰ˆï¼‰</span></a></h2><div class="language-txt line-numbers-mode" data-highlighter="shiki" data-ext="txt" data-title="txt" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>+-------------------+        +----------------+</span></span>
<span class="line"><span>| BrowserRouter     | ---&gt;   | åˆ›å»º History   |</span></span>
<span class="line"><span>+-------------------+        +----------------+</span></span>
<span class="line"><span>        |</span></span>
<span class="line"><span>        v</span></span>
<span class="line"><span>+--------------------------+</span></span>
<span class="line"><span>| ç›‘å¬ URL æ”¹å˜ï¼ˆpopstateï¼‰|</span></span>
<span class="line"><span>+--------------------------+</span></span>
<span class="line"><span>        |</span></span>
<span class="line"><span>        v</span></span>
<span class="line"><span>+--------------------------+</span></span>
<span class="line"><span>| æ›´æ–° locationï¼Œæ›´æ–°çŠ¶æ€  |</span></span>
<span class="line"><span>+--------------------------+</span></span>
<span class="line"><span>        |</span></span>
<span class="line"><span>        v</span></span>
<span class="line"><span>+--------------------------+</span></span>
<span class="line"><span>| é‡æ–°æ‰§è¡Œ matchRoutes     |</span></span>
<span class="line"><span>+--------------------------+</span></span>
<span class="line"><span>        |</span></span>
<span class="line"><span>        v</span></span>
<span class="line"><span>+--------------------------+</span></span>
<span class="line"><span>| æ¸²æŸ“åŒ¹é…åˆ°çš„ç»„ä»¶         |</span></span>
<span class="line"><span>+--------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="ä¸‰ã€è·¯ç”±è·³è½¬åŸç†" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€è·¯ç”±è·³è½¬åŸç†"><span>ä¸‰ã€è·¯ç”±è·³è½¬åŸç†</span></a></h2><h3 id="ç¼–ç¨‹å¼è·³è½¬" tabindex="-1"><a class="header-anchor" href="#ç¼–ç¨‹å¼è·³è½¬"><span>ç¼–ç¨‹å¼è·³è½¬</span></a></h3><div class="language-tsx line-numbers-mode" data-highlighter="shiki" data-ext="tsx" data-title="tsx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> navigate</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> useNavigate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">navigate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;/about&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨åï¼š</p><ul><li>å†…éƒ¨æ‰§è¡Œäº† <code>history.push(&#39;/about&#39;)</code></li><li>è§¦å‘ <code>location</code> çŠ¶æ€æ›´æ–°</li><li>Router é‡æ–°åŒ¹é…å¹¶æ¸²æŸ“ç»„ä»¶</li></ul><hr><h3 id="link-to-about-å®ç°" tabindex="-1"><a class="header-anchor" href="#link-to-about-å®ç°"><span><code>&lt;Link to=&quot;/about&quot; /&gt;</code> å®ç°</span></a></h3><p><code>&lt;Link&gt;</code> ç»„ä»¶çš„å®ç°æœ¬è´¨å°±æ˜¯é˜»æ­¢é»˜è®¤è·³è½¬è¡Œä¸ºï¼Œç„¶åè°ƒç”¨ <code>history.push()</code>ï¼š</p><div class="language-tsx line-numbers-mode" data-highlighter="shiki" data-ext="tsx" data-title="tsx" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> href</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/about&quot;</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> onClick</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">preventDefault</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">  history</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;/about&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  About</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="å››ã€ä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€ç‰ˆè·¯ç”±" tabindex="-1"><a class="header-anchor" href="#å››ã€ä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€ç‰ˆè·¯ç”±"><span>å››ã€ä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€ç‰ˆè·¯ç”±</span></a></h2><h3 id="æ ¸å¿ƒç‚¹" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒç‚¹"><span>æ ¸å¿ƒç‚¹ï¼š</span></a></h3><ul><li>ç›‘å¬ <code>popstate</code> / <code>hashchange</code></li><li>ç”¨ context æä¾› <code>location</code></li><li>ç”¨åŒ¹é…ç®—æ³•å†³å®šæ¸²æŸ“å“ªä¸ªç»„ä»¶</li></ul><hr><h2 id="äº”ã€æ€»ç»“-é¢è¯•å¤è¿°ç‰ˆ" tabindex="-1"><a class="header-anchor" href="#äº”ã€æ€»ç»“-é¢è¯•å¤è¿°ç‰ˆ"><span>äº”ã€æ€»ç»“ï¼ˆé¢è¯•å¤è¿°ç‰ˆï¼‰</span></a></h2><table><thead><tr><th>ç‚¹ä½</th><th>å†…å®¹</th></tr></thead><tbody><tr><td>è·¯ç”±æ¨¡å¼</td><td>ä½¿ç”¨ <code>history</code> æˆ– <code>hash</code> æ¨¡å¼ç›‘å¬ URL</td></tr><tr><td>è·¯ç”±çŠ¶æ€ç®¡ç†</td><td>ç”¨ <code>React Context</code> æä¾› <code>location</code> å’Œ <code>navigate</code></td></tr><tr><td>åŒ¹é…æœºåˆ¶</td><td><code>matchRoutes()</code> éå†é…ç½®å’Œå½“å‰è·¯å¾„è¿›è¡ŒåŒ¹é…</td></tr><tr><td>æ¸²æŸ“æœºåˆ¶</td><td>ä½¿ç”¨ <code>&lt;Routes&gt;</code> å’Œ <code>&lt;Route&gt;</code> æ§åˆ¶æ¸²æŸ“</td></tr><tr><td>è·³è½¬åŸç†</td><td><code>history.push()</code> æ”¹å˜è·¯å¾„ï¼Œè§¦å‘é‡æ–°åŒ¹é…</td></tr></tbody></table><hr><p>è¦å®ç°ä¸€ä¸ªç®€å•çš„ React è·¯ç”±åº“ï¼ˆç±»ä¼¼ <code>react-router-dom</code>ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ä»æœ€åŸºæœ¬çš„è·¯ç”±åŒ¹é…ã€å¯¼èˆªã€ç»„ä»¶æ¸²æŸ“ç­‰åŠŸèƒ½ç€æ‰‹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„è·¯ç”±å®ç°æ€è·¯ã€‚æˆ‘ä»¬å°†æ‰‹åŠ¨ç®¡ç†è·¯ç”±çš„çŠ¶æ€ã€ç»„ä»¶çš„æ¸²æŸ“ï¼Œå¹¶åˆ©ç”¨ React çš„ Context å’Œ Hooks æ¥ç®¡ç†å¯¼èˆªå’Œè·¯ç”±çŠ¶æ€ã€‚</p><h3 id="_1-åˆ›å»º-routercontext" tabindex="-1"><a class="header-anchor" href="#_1-åˆ›å»º-routercontext"><span>1. åˆ›å»º <code>RouterContext</code></span></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª <code>RouterContext</code> æ¥å­˜å‚¨å½“å‰è·¯ç”±ä¿¡æ¯ï¼Œå¹¶æä¾›è·¯ç”±è·³è½¬çš„åŠŸèƒ½ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> React</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">createContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">useContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">useState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">useEffect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// åˆ›å»ºè·¯ç”±ä¸Šä¸‹æ–‡</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> RouterContext</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> createContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> useRouter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> useContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">RouterContext</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> RouterProvider</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">children</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">setLocation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> useState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">window</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  useEffect</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // ç›‘å¬æµè§ˆå™¨çš„ popstate äº‹ä»¶</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handlePopState</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">      setLocation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">window</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    window</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">addEventListener</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;popstate&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">handlePopState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">      window</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">removeEventListener</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;popstate&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">handlePopState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> navigate</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    window</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">history</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pushState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({}, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    setLocation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// æ›´æ–°å½“å‰è·¯ç”±</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RouterContext.Provider</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> value</span><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">={{ location, navigate }}&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">      {</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">    &lt;/RouterContext.Provider&gt;</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">  );</span></span>
<span class="line"><span style="--shiki-light:white;--shiki-dark:#FFFFFF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>RouterProvider</code> æ˜¯æˆ‘ä»¬æ•´ä¸ªè·¯ç”±ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨å’Œæ›´æ–°å½“å‰è·¯å¾„ã€‚</li><li><code>useRouter</code> æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ Hookï¼Œç”¨æ¥æ–¹ä¾¿åœ°è·å–è·¯ç”±ä¿¡æ¯å’Œå¯¼èˆªå‡½æ•°ã€‚</li></ul><hr><h3 id="_2-åˆ›å»º-route-ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-åˆ›å»º-route-ç»„ä»¶"><span>2. åˆ›å»º <code>Route</code> ç»„ä»¶</span></a></h3><p><code>Route</code> ç»„ä»¶ç”¨äºæ ¹æ®è·¯å¾„åŒ¹é…å½“å‰ URLï¼Œå¹¶æ¸²æŸ“ç›¸åº”çš„ç»„ä»¶ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Route</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">component</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">location</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> useRouter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // ç®€å•çš„è·¯å¾„åŒ¹é…</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> match</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> location</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> match</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> component</span><span style="--shiki-light:#0184BC;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// å¦‚æœè·¯å¾„åŒ¹é…ï¼Œæ¸²æŸ“ç»„ä»¶</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Route</code> ä¼šæ£€æŸ¥å½“å‰çš„è·¯å¾„ï¼ˆ<code>location</code>ï¼‰æ˜¯å¦ä¸ <code>path</code> åŒ¹é…ã€‚å¦‚æœåŒ¹é…ï¼Œåˆ™æ¸²æŸ“å¯¹åº”çš„ç»„ä»¶ã€‚</li></ul><hr><h3 id="_3-åˆ›å»º-link-ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#_3-åˆ›å»º-link-ç»„ä»¶"><span>3. åˆ›å»º <code>Link</code> ç»„ä»¶</span></a></h3><p><code>Link</code> ç”¨äºåœ¨ç”¨æˆ·ç‚¹å‡»æ—¶è§¦å‘è·¯ç”±è·³è½¬ã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Link</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">to</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">children</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">navigate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> useRouter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> handleClick</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">    e</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">preventDefault</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    navigate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">to</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> href</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">to</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> onClick</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">handleClick</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Link</code> ç»„ä»¶é€šè¿‡ <code>navigate</code> å‡½æ•°è¿›è¡Œè·¯ç”±è·³è½¬ã€‚æˆ‘ä»¬ä¹Ÿé˜»æ­¢äº†é»˜è®¤çš„è·³è½¬è¡Œä¸ºï¼ˆé˜²æ­¢é¡µé¢åˆ·æ–°ï¼‰ã€‚</li></ul><hr><h3 id="_4-ä½¿ç”¨-router" tabindex="-1"><a class="header-anchor" href="#_4-ä½¿ç”¨-router"><span>4. ä½¿ç”¨ Router</span></a></h3><p>æˆ‘ä»¬å¯ä»¥å°†è¿™äº›ç»„ä»¶ç»„åˆèµ·æ¥ï¼Œå®ç°ä¸€ä¸ªç®€æ˜“çš„è·¯ç”±ç³»ç»Ÿã€‚</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> React</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">RouterProvider</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Route</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Link</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;./router&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Home</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;Home Page&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> About</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;About Page&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">h2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RouterProvider</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nav</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          &lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Link</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> to</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;Home&lt;/</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Link</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          &lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Link</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> to</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/about&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;About&lt;/</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Link</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">nav</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          &lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Route</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> path</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/&quot;</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> component</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Home</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">          &lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Route</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> path</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/about&quot;</span><span style="--shiki-light:#986801;--shiki-light-font-style:inherit;--shiki-dark:#D19A66;--shiki-dark-font-style:italic;"> component</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">About</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">RouterProvider</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> App</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><p>æˆ‘ä»¬ç”¨å‡ ä¸ªç®€å•çš„ React API å®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„è·¯ç”±åº“ï¼š</p><ol><li><strong><code>RouterProvider</code></strong>ï¼šæä¾›å½“å‰è·¯å¾„å’Œè·¯ç”±è·³è½¬åŠŸèƒ½ï¼ˆ<code>navigate</code>ï¼‰ã€‚</li><li><strong><code>Route</code></strong>ï¼šæ ¹æ®å½“å‰è·¯å¾„æ¥æ¸²æŸ“åŒ¹é…çš„ç»„ä»¶ã€‚</li><li><strong><code>Link</code></strong>ï¼šåˆ›å»ºè·¯ç”±é“¾æ¥ï¼Œé¿å…é¡µé¢åˆ·æ–°å¹¶ä½¿ç”¨ <code>navigate</code> æ¥è¿›è¡Œè·¯ç”±è·³è½¬ã€‚</li></ol>`,238)]))}const d=i(e,[["render",t]]),r=JSON.parse('{"path":"/posts/react/react%20%E9%9D%A2%E8%AF%95.html","title":"Reacté¢è¯•","lang":"zh-CN","frontmatter":{"title":"Reacté¢è¯•","tags":["react"],"description":"ğŸ§  ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ React æ¸²æŸ“åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰ï¼šæ”¶é›†æ›´æ–°è¯·æ±‚å¹¶å®‰æ’ä¼˜å…ˆçº§ æ¸²æŸ“é˜¶æ®µï¼ˆRender Phaseï¼‰ï¼šæ„å»ºå¹¶ diff Fiber æ ‘ï¼Œæ ‡è®°æ‰€æœ‰å˜æ›´ æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰ï¼šä¸€æ¬¡æ€§å°†æ‰€æœ‰å˜æ›´åº”ç”¨åˆ° DOMï¼Œå¹¶æ‰§è¡Œå‰¯ä½œç”¨ 1. ğŸŸ¡ è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰ è§¦å‘æ›´...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/zy-vuepress/posts/react/react%20%E9%9D%A2%E8%AF%95.html"}],["meta",{"property":"og:site_name","content":"æˆ‘çš„åŸºåœ°"}],["meta",{"property":"og:title","content":"Reacté¢è¯•"}],["meta",{"property":"og:description","content":"ğŸ§  ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ React æ¸²æŸ“åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰ï¼šæ”¶é›†æ›´æ–°è¯·æ±‚å¹¶å®‰æ’ä¼˜å…ˆçº§ æ¸²æŸ“é˜¶æ®µï¼ˆRender Phaseï¼‰ï¼šæ„å»ºå¹¶ diff Fiber æ ‘ï¼Œæ ‡è®°æ‰€æœ‰å˜æ›´ æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰ï¼šä¸€æ¬¡æ€§å°†æ‰€æœ‰å˜æ›´åº”ç”¨åˆ° DOMï¼Œå¹¶æ‰§è¡Œå‰¯ä½œç”¨ 1. ğŸŸ¡ è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰ è§¦å‘æ›´..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-13T09:49:44.000Z"}],["meta",{"property":"article:tag","content":"react"}],["meta",{"property":"article:modified_time","content":"2025-05-13T09:49:44.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Reacté¢è¯•\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-05-13T09:49:44.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mrs.Zoe\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"ğŸ§  ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ","slug":"ğŸ§ -ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ","link":"#ğŸ§ -ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ","children":[]},{"level":2,"title":"1. ğŸŸ¡ è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰","slug":"_1-ğŸŸ¡-è°ƒåº¦é˜¶æ®µ-schedule-phase","link":"#_1-ğŸŸ¡-è°ƒåº¦é˜¶æ®µ-schedule-phase","children":[]},{"level":2,"title":"2. ğŸ”µ æ¸²æŸ“é˜¶æ®µï¼ˆRender Phaseï¼‰","slug":"_2-ğŸ”µ-æ¸²æŸ“é˜¶æ®µ-render-phase","link":"#_2-ğŸ”µ-æ¸²æŸ“é˜¶æ®µ-render-phase","children":[{"level":3,"title":"2.1 éå†ç­–ç•¥ â€”â€” æ·±åº¦ä¼˜å…ˆï¼ˆDFSï¼‰","slug":"_2-1-éå†ç­–ç•¥-â€”â€”-æ·±åº¦ä¼˜å…ˆ-dfs","link":"#_2-1-éå†ç­–ç•¥-â€”â€”-æ·±åº¦ä¼˜å…ˆ-dfs","children":[]},{"level":3,"title":"2.2 Diff & æ ‡è®°å˜æ›´","slug":"_2-2-diff-æ ‡è®°å˜æ›´","link":"#_2-2-diff-æ ‡è®°å˜æ›´","children":[]},{"level":3,"title":"2.3 completeWorkï¼šæ”¶é›†å‰¯ä½œç”¨","slug":"_2-3-completework-æ”¶é›†å‰¯ä½œç”¨","link":"#_2-3-completework-æ”¶é›†å‰¯ä½œç”¨","children":[]}]},{"level":2,"title":"3. ğŸ”´ æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰","slug":"_3-ğŸ”´-æäº¤é˜¶æ®µ-commit-phase","link":"#_3-ğŸ”´-æäº¤é˜¶æ®µ-commit-phase","children":[]},{"level":2,"title":"âœ¨ å°ç»“","slug":"âœ¨-å°ç»“","link":"#âœ¨-å°ç»“","children":[]},{"level":2,"title":"setState","slug":"setstate","link":"#setstate","children":[]},{"level":2,"title":"ä¸€ã€ useState çš„å®ç°åŸç†ï¼Ÿ","slug":"ä¸€ã€-usestate-çš„å®ç°åŸç†","link":"#ä¸€ã€-usestate-çš„å®ç°åŸç†","children":[{"level":3,"title":"âœ… 1. useState æ˜¯å¦‚ä½•ä¿å­˜çŠ¶æ€çš„ï¼Ÿ","slug":"âœ…-1-usestate-æ˜¯å¦‚ä½•ä¿å­˜çŠ¶æ€çš„","link":"#âœ…-1-usestate-æ˜¯å¦‚ä½•ä¿å­˜çŠ¶æ€çš„","children":[]},{"level":3,"title":"âœ… 2. useState çš„åŸºæœ¬æ‰§è¡Œæµç¨‹","slug":"âœ…-2-usestate-çš„åŸºæœ¬æ‰§è¡Œæµç¨‹","link":"#âœ…-2-usestate-çš„åŸºæœ¬æ‰§è¡Œæµç¨‹","children":[]},{"level":3,"title":"âœ… 3. å¤šæ¬¡ useState æ€ä¹ˆåŒºåˆ†ï¼Ÿ","slug":"âœ…-3-å¤šæ¬¡-usestate-æ€ä¹ˆåŒºåˆ†","link":"#âœ…-3-å¤šæ¬¡-usestate-æ€ä¹ˆåŒºåˆ†","children":[]},{"level":3,"title":"âœ… 4. ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶è¯­å¥é‡Œç”¨ Hookï¼Ÿ","slug":"âœ…-4-ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶è¯­å¥é‡Œç”¨-hook","link":"#âœ…-4-ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶è¯­å¥é‡Œç”¨-hook","children":[]}]},{"level":2,"title":"äºŒã€æºç è§’åº¦æ·±å…¥å‰–æ","slug":"äºŒã€æºç è§’åº¦æ·±å…¥å‰–æ","link":"#äºŒã€æºç è§’åº¦æ·±å…¥å‰–æ","children":[{"level":3,"title":"1. åˆå§‹åŒ–é˜¶æ®µï¼ˆé¦–æ¬¡ renderï¼‰","slug":"_1-åˆå§‹åŒ–é˜¶æ®µ-é¦–æ¬¡-render","link":"#_1-åˆå§‹åŒ–é˜¶æ®µ-é¦–æ¬¡-render","children":[]},{"level":3,"title":"2. æ›´æ–°é˜¶æ®µï¼ˆre-renderï¼‰","slug":"_2-æ›´æ–°é˜¶æ®µ-re-render","link":"#_2-æ›´æ–°é˜¶æ®µ-re-render","children":[]}]},{"level":2,"title":"ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„å›¾è§£","slug":"ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„å›¾è§£","link":"#ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„å›¾è§£","children":[]},{"level":2,"title":"å››ã€ä½ å¯ä»¥æåˆ°çš„è¡¥å……ç‚¹ï¼ˆåŠ åˆ†ï¼‰","slug":"å››ã€ä½ å¯ä»¥æåˆ°çš„è¡¥å……ç‚¹-åŠ åˆ†","link":"#å››ã€ä½ å¯ä»¥æåˆ°çš„è¡¥å……ç‚¹-åŠ åˆ†","children":[]},{"level":2,"title":"æ€»ç»“ä¸€å¥è¯å›ç­”ï¼ˆç²¾ç®€ç‰ˆï¼‰ï¼š","slug":"æ€»ç»“ä¸€å¥è¯å›ç­”-ç²¾ç®€ç‰ˆ","link":"#æ€»ç»“ä¸€å¥è¯å›ç­”-ç²¾ç®€ç‰ˆ","children":[]},{"level":2,"title":"ğŸ§  ä¸€ã€useEffect å®ç°åŸç†ï¼Ÿ","slug":"ğŸ§ -ä¸€ã€useeffect-å®ç°åŸç†","link":"#ğŸ§ -ä¸€ã€useeffect-å®ç°åŸç†","children":[{"level":3,"title":"âœ… 1. useEffect çŠ¶æ€çš„ä¿å­˜æœºåˆ¶","slug":"âœ…-1-useeffect-çŠ¶æ€çš„ä¿å­˜æœºåˆ¶","link":"#âœ…-1-useeffect-çŠ¶æ€çš„ä¿å­˜æœºåˆ¶","children":[]},{"level":3,"title":"âœ… 2. useEffect ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ","slug":"âœ…-2-useeffect-ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ","link":"#âœ…-2-useeffect-ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ","children":[]},{"level":3,"title":"âœ… 3. useEffect æ˜¯æ€ä¹ˆçŸ¥é“ä¾èµ–å˜åŒ–çš„ï¼Ÿ","slug":"âœ…-3-useeffect-æ˜¯æ€ä¹ˆçŸ¥é“ä¾èµ–å˜åŒ–çš„","link":"#âœ…-3-useeffect-æ˜¯æ€ä¹ˆçŸ¥é“ä¾èµ–å˜åŒ–çš„","children":[]},{"level":3,"title":"âœ… 4. ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶ä¸­ä½¿ç”¨ useEffectï¼Ÿ","slug":"âœ…-4-ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶ä¸­ä½¿ç”¨-useeffect","link":"#âœ…-4-ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶ä¸­ä½¿ç”¨-useeffect","children":[]}]},{"level":2,"title":"ğŸ§© äºŒã€æºç å±‚é¢ç®€åŒ–è§£æ","slug":"ğŸ§©-äºŒã€æºç å±‚é¢ç®€åŒ–è§£æ","link":"#ğŸ§©-äºŒã€æºç å±‚é¢ç®€åŒ–è§£æ","children":[{"level":3,"title":"ğŸ”§ 1. render é˜¶æ®µæ³¨å†Œ effectï¼š","slug":"ğŸ”§-1-render-é˜¶æ®µæ³¨å†Œ-effect","link":"#ğŸ”§-1-render-é˜¶æ®µæ³¨å†Œ-effect","children":[]},{"level":3,"title":"ğŸ”„ 2. commit é˜¶æ®µæ‰§è¡Œ effectï¼š","slug":"ğŸ”„-2-commit-é˜¶æ®µæ‰§è¡Œ-effect","link":"#ğŸ”„-2-commit-é˜¶æ®µæ‰§è¡Œ-effect","children":[]}]},{"level":2,"title":"ğŸ”„ ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„ç¤ºæ„å›¾","slug":"ğŸ”„-ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„ç¤ºæ„å›¾","link":"#ğŸ”„-ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„ç¤ºæ„å›¾","children":[]},{"level":2,"title":"ğŸ’¡ å››ã€ç®€ç‰ˆæ€»ç»“å›ç­”ï¼ˆé€‚åˆé¢è¯•ï¼‰","slug":"ğŸ’¡-å››ã€ç®€ç‰ˆæ€»ç»“å›ç­”-é€‚åˆé¢è¯•","link":"#ğŸ’¡-å››ã€ç®€ç‰ˆæ€»ç»“å›ç­”-é€‚åˆé¢è¯•","children":[]},{"level":2,"title":"ğŸ›  äº”ã€è¿›é˜¶è¡¥å……ï¼ˆåŠ åˆ†é¡¹ï¼‰","slug":"ğŸ› -äº”ã€è¿›é˜¶è¡¥å……-åŠ åˆ†é¡¹","link":"#ğŸ› -äº”ã€è¿›é˜¶è¡¥å……-åŠ åˆ†é¡¹","children":[]},{"level":2,"title":"ğŸ§  Suspense æ ¸å¿ƒåŸç†ä¸€å¥è¯æ€»ç»“ï¼š","slug":"ğŸ§ -suspense-æ ¸å¿ƒåŸç†ä¸€å¥è¯æ€»ç»“","link":"#ğŸ§ -suspense-æ ¸å¿ƒåŸç†ä¸€å¥è¯æ€»ç»“","children":[]},{"level":2,"title":"âœ… å®ç°æœºåˆ¶åˆ†ä¸‰æ­¥ï¼š","slug":"âœ…-å®ç°æœºåˆ¶åˆ†ä¸‰æ­¥","link":"#âœ…-å®ç°æœºåˆ¶åˆ†ä¸‰æ­¥","children":[{"level":3,"title":"1. React.lazy() è¿”å›çš„æ˜¯ä¸€ä¸ªâ€œæ‡’åŠ è½½ç»„ä»¶â€","slug":"_1-react-lazy-è¿”å›çš„æ˜¯ä¸€ä¸ª-æ‡’åŠ è½½ç»„ä»¶","link":"#_1-react-lazy-è¿”å›çš„æ˜¯ä¸€ä¸ª-æ‡’åŠ è½½ç»„ä»¶","children":[]},{"level":3,"title":"2. <Suspense fallback> æ•è·â€œå¼‚å¸¸æ¸²æŸ“â€","slug":"_2-suspense-fallback-æ•è·-å¼‚å¸¸æ¸²æŸ“","link":"#_2-suspense-fallback-æ•è·-å¼‚å¸¸æ¸²æŸ“","children":[]},{"level":3,"title":"3. å¼‚æ­¥å®Œæˆåé‡æ–°æ¸²æŸ“","slug":"_3-å¼‚æ­¥å®Œæˆåé‡æ–°æ¸²æŸ“","link":"#_3-å¼‚æ­¥å®Œæˆåé‡æ–°æ¸²æŸ“","children":[]}]},{"level":2,"title":"ğŸ–¼ï¸ æµç¨‹å›¾ç®€åŒ–ï¼š","slug":"ğŸ–¼ï¸-æµç¨‹å›¾ç®€åŒ–","link":"#ğŸ–¼ï¸-æµç¨‹å›¾ç®€åŒ–","children":[]},{"level":2,"title":"ğŸ§ª ç±»æ¯”ï¼š","slug":"ğŸ§ª-ç±»æ¯”","link":"#ğŸ§ª-ç±»æ¯”","children":[]},{"level":2,"title":"ğŸ“¦ é™¤äº† lazyï¼Œè°è¿˜èƒ½ç”¨ Suspenseï¼Ÿ","slug":"ğŸ“¦-é™¤äº†-lazy-è°è¿˜èƒ½ç”¨-suspense","link":"#ğŸ“¦-é™¤äº†-lazy-è°è¿˜èƒ½ç”¨-suspense","children":[]},{"level":2,"title":"âœ… æ€»ç»“","slug":"âœ…-æ€»ç»“","link":"#âœ…-æ€»ç»“","children":[]},{"level":2,"title":"âœ… ç®€åŒ–ç‰ˆ React.lazy + Suspense å®ç°","slug":"âœ…-ç®€åŒ–ç‰ˆ-react-lazy-suspense-å®ç°","link":"#âœ…-ç®€åŒ–ç‰ˆ-react-lazy-suspense-å®ç°","children":[{"level":3,"title":"1ï¸âƒ£ lazy æ¨¡æ‹Ÿç‰ˆ","slug":"_1ï¸âƒ£-lazy-æ¨¡æ‹Ÿç‰ˆ","link":"#_1ï¸âƒ£-lazy-æ¨¡æ‹Ÿç‰ˆ","children":[]},{"level":3,"title":"2ï¸âƒ£ ç®€åŒ–ç‰ˆ Suspense å®ç°","slug":"_2ï¸âƒ£-ç®€åŒ–ç‰ˆ-suspense-å®ç°","link":"#_2ï¸âƒ£-ç®€åŒ–ç‰ˆ-suspense-å®ç°","children":[]},{"level":3,"title":"3ï¸âƒ£ æµ‹è¯•ï¼šå»¶è¿Ÿç»„ä»¶","slug":"_3ï¸âƒ£-æµ‹è¯•-å»¶è¿Ÿç»„ä»¶","link":"#_3ï¸âƒ£-æµ‹è¯•-å»¶è¿Ÿç»„ä»¶","children":[]},{"level":3,"title":"âœ… è¾“å‡ºç»“æœï¼š","slug":"âœ…-è¾“å‡ºç»“æœ","link":"#âœ…-è¾“å‡ºç»“æœ","children":[]}]},{"level":2,"title":"ğŸ“š React æºç å±‚é¢ï¼šå¦‚ä½•çœŸæ­£å®ç°æŒ‚èµ·ï¼Ÿ","slug":"ğŸ“š-react-æºç å±‚é¢-å¦‚ä½•çœŸæ­£å®ç°æŒ‚èµ·","link":"#ğŸ“š-react-æºç å±‚é¢-å¦‚ä½•çœŸæ­£å®ç°æŒ‚èµ·","children":[{"level":3,"title":"1. ç»„ä»¶æŠ›å‡º Promise çš„æ—¶å€™","slug":"_1-ç»„ä»¶æŠ›å‡º-promise-çš„æ—¶å€™","link":"#_1-ç»„ä»¶æŠ›å‡º-promise-çš„æ—¶å€™","children":[]},{"level":3,"title":"2. Suspense è¾ƒè¿‘è¾¹ç•Œæ‹¦æˆªå®ƒ","slug":"_2-suspense-è¾ƒè¿‘è¾¹ç•Œæ‹¦æˆªå®ƒ","link":"#_2-suspense-è¾ƒè¿‘è¾¹ç•Œæ‹¦æˆªå®ƒ","children":[]},{"level":3,"title":"3. Promise resolve åçš„ ping æœºåˆ¶","slug":"_3-promise-resolve-åçš„-ping-æœºåˆ¶","link":"#_3-promise-resolve-åçš„-ping-æœºåˆ¶","children":[]}]},{"level":2,"title":"ğŸ§  memoizedState æ˜¯æ€ä¹ˆé…åˆçš„ï¼Ÿ","slug":"ğŸ§ -memoizedstate-æ˜¯æ€ä¹ˆé…åˆçš„","link":"#ğŸ§ -memoizedstate-æ˜¯æ€ä¹ˆé…åˆçš„","children":[]},{"level":2,"title":"âœ… æ€»ç»“","slug":"âœ…-æ€»ç»“-1","link":"#âœ…-æ€»ç»“-1","children":[]},{"level":2,"title":"react è·¯ç”±","slug":"react-è·¯ç”±","link":"#react-è·¯ç”±","children":[]},{"level":2,"title":"React Router","slug":"react-router","link":"#react-router","children":[{"level":3,"title":"1. URL å˜åŒ–ç›‘å¬","slug":"_1-url-å˜åŒ–ç›‘å¬","link":"#_1-url-å˜åŒ–ç›‘å¬","children":[]},{"level":3,"title":"2. history å¯¹è±¡çš„å°è£…","slug":"_2-history-å¯¹è±¡çš„å°è£…","link":"#_2-history-å¯¹è±¡çš„å°è£…","children":[]},{"level":3,"title":"3. Router Context æä¾›å½“å‰ location","slug":"_3-router-context-æä¾›å½“å‰-location","link":"#_3-router-context-æä¾›å½“å‰-location","children":[]},{"level":3,"title":"4. è·¯ç”±åŒ¹é…åŸç†ï¼ˆé€’å½’åŒ¹é…ï¼‰","slug":"_4-è·¯ç”±åŒ¹é…åŸç†-é€’å½’åŒ¹é…","link":"#_4-è·¯ç”±åŒ¹é…åŸç†-é€’å½’åŒ¹é…","children":[]},{"level":3,"title":"5. åŠ¨æ€æ¸²æŸ“ç»„ä»¶","slug":"_5-åŠ¨æ€æ¸²æŸ“ç»„ä»¶","link":"#_5-åŠ¨æ€æ¸²æŸ“ç»„ä»¶","children":[]}]},{"level":2,"title":"äºŒã€æ•´ä½“æµç¨‹å›¾ç¤ºï¼ˆç®€åŒ–ç‰ˆï¼‰","slug":"äºŒã€æ•´ä½“æµç¨‹å›¾ç¤º-ç®€åŒ–ç‰ˆ","link":"#äºŒã€æ•´ä½“æµç¨‹å›¾ç¤º-ç®€åŒ–ç‰ˆ","children":[]},{"level":2,"title":"ä¸‰ã€è·¯ç”±è·³è½¬åŸç†","slug":"ä¸‰ã€è·¯ç”±è·³è½¬åŸç†","link":"#ä¸‰ã€è·¯ç”±è·³è½¬åŸç†","children":[{"level":3,"title":"ç¼–ç¨‹å¼è·³è½¬","slug":"ç¼–ç¨‹å¼è·³è½¬","link":"#ç¼–ç¨‹å¼è·³è½¬","children":[]},{"level":3,"title":"<Link to=\\"/about\\" /> å®ç°","slug":"link-to-about-å®ç°","link":"#link-to-about-å®ç°","children":[]}]},{"level":2,"title":"å››ã€ä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€ç‰ˆè·¯ç”±","slug":"å››ã€ä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€ç‰ˆè·¯ç”±","link":"#å››ã€ä½ å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€ç‰ˆè·¯ç”±","children":[{"level":3,"title":"æ ¸å¿ƒç‚¹ï¼š","slug":"æ ¸å¿ƒç‚¹","link":"#æ ¸å¿ƒç‚¹","children":[]}]},{"level":2,"title":"äº”ã€æ€»ç»“ï¼ˆé¢è¯•å¤è¿°ç‰ˆï¼‰","slug":"äº”ã€æ€»ç»“-é¢è¯•å¤è¿°ç‰ˆ","link":"#äº”ã€æ€»ç»“-é¢è¯•å¤è¿°ç‰ˆ","children":[{"level":3,"title":"1. åˆ›å»º RouterContext","slug":"_1-åˆ›å»º-routercontext","link":"#_1-åˆ›å»º-routercontext","children":[]},{"level":3,"title":"2. åˆ›å»º Route ç»„ä»¶","slug":"_2-åˆ›å»º-route-ç»„ä»¶","link":"#_2-åˆ›å»º-route-ç»„ä»¶","children":[]},{"level":3,"title":"3. åˆ›å»º Link ç»„ä»¶","slug":"_3-åˆ›å»º-link-ç»„ä»¶","link":"#_3-åˆ›å»º-link-ç»„ä»¶","children":[]},{"level":3,"title":"4. ä½¿ç”¨ Router","slug":"_4-ä½¿ç”¨-router","link":"#_4-ä½¿ç”¨-router","children":[]},{"level":3,"title":"æ€»ç»“","slug":"æ€»ç»“","link":"#æ€»ç»“","children":[]}]}],"git":{"createdTime":1747118121000,"updatedTime":1747129784000,"contributors":[{"name":"zouyu","username":"zouyu","email":"891374900@qq.com","commits":3,"url":"https://github.com/zouyu"},{"name":"zy","username":"zy","email":"891374900@qq.com","commits":2,"url":"https://github.com/zy"}]},"readingTime":{"minutes":14.59,"words":4376},"filePathRelative":"posts/react/react é¢è¯•.md","localizedDate":"2025å¹´5æœˆ13æ—¥","excerpt":"<h2>ğŸ§  ä¸€ã€æ¸²æŸ“æµç¨‹æ¦‚è§ˆ</h2>\\n<p>React æ¸²æŸ“åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>\\n<ol>\\n<li><strong>è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰</strong>ï¼šæ”¶é›†æ›´æ–°è¯·æ±‚å¹¶å®‰æ’ä¼˜å…ˆçº§</li>\\n<li><strong>æ¸²æŸ“é˜¶æ®µï¼ˆRender Phaseï¼‰</strong>ï¼šæ„å»ºå¹¶ diff Fiber æ ‘ï¼Œæ ‡è®°æ‰€æœ‰å˜æ›´</li>\\n<li><strong>æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰</strong>ï¼šä¸€æ¬¡æ€§å°†æ‰€æœ‰å˜æ›´åº”ç”¨åˆ° DOMï¼Œå¹¶æ‰§è¡Œå‰¯ä½œç”¨</li>\\n</ol>\\n<hr>\\n<h2>1. ğŸŸ¡ è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰</h2>\\n<ul>\\n<li><strong>è§¦å‘æ›´æ–°</strong>ï¼šè°ƒç”¨ <code>setState</code>ã€<code>dispatch</code>ã€<code>useState</code> æ›´æ–° Hook ç­‰ã€‚</li>\\n<li><strong>æ³¨å†Œä»»åŠ¡</strong>ï¼š<code>scheduleUpdateOnFiber(fiber, lane)</code> ä¼šå°†æ›´æ–°åŠ å…¥è°ƒåº¦é˜Ÿåˆ—ï¼Œå¹¶æ ‡è®°ä¼˜å…ˆçº§ï¼ˆLaneï¼‰ã€‚</li>\\n<li><strong>æ—¶é—´åˆ‡ç‰‡ &amp; å¹¶å‘</strong>ï¼šå€ŸåŠ© Schedulerï¼ŒReact å¯åœ¨ä¸­æ–­ç‚¹æš‚åœæ¸²æŸ“ï¼Œå°†é«˜ä¼˜å…ˆçº§ä»»åŠ¡æ’å…¥ï¼Œä¿è¯ç•Œé¢å“åº”æµç•…ã€‚</li>\\n</ul>","autoDesc":true}');export{d as comp,r as data};
