import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,e as a,o as n}from"./app-D4yN_ylH.js";const t={};function l(r,s){return n(),i("div",null,s[0]||(s[0]=[a(`<p>以下是一份面向企业级 Monorepo 项目的 <strong>Changesets 实战手册</strong>，涵盖仓库架构、自动化版本管理、CI/CD 集成、构建优化、高级发布策略及最佳实践，全部示例均基于真实开源项目和社区经验整理。</p><h2 id="概要" tabindex="-1"><a class="header-anchor" href="#概要"><span>概要</span></a></h2><p>企业级 Monorepo 往往包含上百个包和多个应用，手动维护版本和发布流程极易出错。<strong>Changesets</strong> 通过在 <code>.changeset/</code> 目录下记录每次变更，结合 CLI 和 GitHub Action，实现了<strong>多包版本自动化管理</strong>、<strong>Changelog 生成</strong>、<strong>Git Tag 打点</strong>和<strong>npm 发布</strong>等全流程自动化，大幅提升团队协作效率和发布安全性 (<a href="https://lirantal.com/blog/introducing-changesets-simplify-project-versioning-with-semantic-releases?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Introducing Changesets: Simplify Project Versioning with Semantic ...</a>) (<a href="https://github.com/changesets/changesets?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">changesets/changesets: A way to manage your versioning ... - GitHub</a>)。</p><hr><h2 id="_1-monorepo-架构设计" tabindex="-1"><a class="header-anchor" href="#_1-monorepo-架构设计"><span>1. Monorepo 架构设计</span></a></h2><h3 id="_1-1-典型目录结构" tabindex="-1"><a class="header-anchor" href="#_1-1-典型目录结构"><span>1.1 典型目录结构</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>/</span></span>
<span class="line"><span>├── apps/            # 可部署应用（如 Web、移动端）</span></span>
<span class="line"><span>├── features/        # 领域功能包（可选）</span></span>
<span class="line"><span>├── libs/            # 公共库（工具函数、设计系统）</span></span>
<span class="line"><span>├── packages/        # 核心业务包</span></span>
<span class="line"><span>├── .changeset/      # Changesets 配置与变更文件</span></span>
<span class="line"><span>├── package.json     # 根级依赖与脚本</span></span>
<span class="line"><span>└── pnpm-workspace.yaml # PNPM/Yarn 工作区配置</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分层存放应用、功能和公共库，可根据团队规模和业务需求自由调整 (<a href="https://hackernoon.com/building-a-robust-jsts-monorepo-best-practices-with-yarn-nx-and-changesets?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Building a Robust JS/TS Monorepo: Best Practices with Yarn, NX ...</a>)。</p><h3 id="_1-2-为什么选-monorepo" tabindex="-1"><a class="header-anchor" href="#_1-2-为什么选-monorepo"><span>1.2 为什么选 Monorepo？</span></a></h3><ul><li><strong>单一源头</strong>：所有包在同一个仓库，依赖升级一次完成，消除版本冲突 (<a href="https://medium.com/%40anandkumar.code/how-a-monorepo-pnpm-and-changesets-transformed-my-multi-package-workflow-7c1771bba898?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">How a Monorepo, pnpm, and Changesets Transformed My Multi ...</a>)。</li><li><strong>一致工具链</strong>：统一 ESLint、Prettier、测试框架和发布流程，降低维护成本 (<a href="https://juejin.cn/post/7277894305992196151?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">基于Pnpm+Changesets的Monorepo工具库实战 - 稀土掘金</a>)。</li><li><strong>跨团队协作</strong>：不同团队可同时修改不同包，变更可即时追踪和回滚 (<a href="https://tech.taobao.org/news/ulamrkootb5ii314?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Monorepo，大型前端项目管理模式实践 - 淘宝技术</a>)。</li></ul><hr><h2 id="_2-changesets-自动化版本管理" tabindex="-1"><a class="header-anchor" href="#_2-changesets-自动化版本管理"><span>2. Changesets 自动化版本管理</span></a></h2><h3 id="_2-1-安装与初始化" tabindex="-1"><a class="header-anchor" href="#_2-1-安装与初始化"><span>2.1 安装与初始化</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pnpm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> @changesets/cli</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> init</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>会在根目录创建 <code>.changeset/config.json</code> 和 <code>.changeset/README.md</code>，用于配置版本规则及 Changelog 模板 (<a href="https://github.com/changesets/changesets?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">changesets/changesets: A way to manage your versioning ... - GitHub</a>)。</p><h3 id="_2-2-记录变更" tabindex="-1"><a class="header-anchor" href="#_2-2-记录变更"><span>2.2 记录变更</span></a></h3><p>每次对某些包做出功能或修复后，运行：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>交互式地选择受影响的包、版本类型（patch/minor/major）并填写描述，生成类似如下的 markdown 文件：</p><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" data-title="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&quot;my-lib&quot;: minor</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&quot;feature-app&quot;: patch</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 新增用户管理功能</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> 修复登录接口超时问题</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该文件会存放在 <code>.changeset/</code> 下，供后续统一 consumption (<a href="https://juejin.cn/post/7276393533086318632?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">在公司项目中使用changesets进行项目管理，提升效率 - 稀土掘金</a>)。</p><h3 id="_2-3-bump-版本与生成-changelog" tabindex="-1"><a class="header-anchor" href="#_2-3-bump-版本与生成-changelog"><span>2.3 Bump 版本与生成 Changelog</span></a></h3><p>当准备发布时，执行：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>根据所有 <code>.changeset/*.md</code> 计算每个包的新版本</li><li>更新各自 <code>package.json</code> 的 <code>version</code></li><li>在各包或根目录的 <code>CHANGELOG.md</code> 中插入新的版本条目</li><li>删除已应用的 <code>.changeset</code> 文件 (<a href="https://github.com/changesets/changesets?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">changesets/changesets: A way to manage your versioning ... - GitHub</a>)。</li></ul><h3 id="_2-4-发布到-npm" tabindex="-1"><a class="header-anchor" href="#_2-4-发布到-npm"><span>2.4 发布到 npm</span></a></h3><p>最后一步：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> publish</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>自动运行各包的 <code>prepare</code> 钩子（推荐在 <code>prepare</code> 中触发构建）</li><li>将所有需要发布的包推到 npm</li><li>在 Git 仓库打上相应的 <code>vX.Y.Z</code> Tag (<a href="https://www.dongbizhen.com/posts/48225/?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">突破项目瓶颈：2024 年Monorepo 工具选择和实践 - BEEZEN</a>)。</li></ul><hr><h2 id="_3-ci-cd-集成" tabindex="-1"><a class="header-anchor" href="#_3-ci-cd-集成"><span>3. CI/CD 集成</span></a></h2><h3 id="_3-1-在-pr-中强制检查-changeset" tabindex="-1"><a class="header-anchor" href="#_3-1-在-pr-中强制检查-changeset"><span>3.1 在 PR 中强制检查 Changeset</span></a></h3><p>在 <code>.github/workflows/ci.yml</code> 中添加：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Check Changesets</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">changesets/action@v1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    check</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>若 PR 中无 <code>.changeset</code> 文件，CI 会失败，保证所有变更都有对应的发布说明 (<a href="https://github.com/changesets/changesets?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">changesets/changesets: A way to manage your versioning ... - GitHub</a>)。</p><h3 id="_3-2-自动化-release-workflow" tabindex="-1"><a class="header-anchor" href="#_3-2-自动化-release-workflow"><span>3.2 自动化 Release Workflow</span></a></h3><p>在 <code>.github/workflows/release.yml</code> 中配置：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  push</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    branches</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">main</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> ]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">jobs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  release</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    runs-on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ubuntu-latest</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    steps</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">actions/checkout@v4</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">fetch-depth</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">actions/setup-node@v4</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          node-version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          registry-url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;https://registry.npmjs.org/&#39;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">run</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">pnpm install</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Version &amp; Changelog</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        uses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">changesets/action@v1</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        with</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">npx changeset version</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          publish</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">npx changeset publish</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        env</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          GITHUB_TOKEN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\${{ secrets.GITHUB_TOKEN }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          NPM_TOKEN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\${{ secrets.NPM_TOKEN }}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>合并到 <code>main</code> 即可完成版本 bump、Changelog 更新、Git Tag、npm 发布全流程，无需人工干预 (<a href="https://blog.csdn.net/weixin_43719925/article/details/136700615?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">基于Pnpm+Changesets的Monorepo工具库实战原创 - CSDN博客</a>) (<a href="https://lirantal.com/blog/introducing-changesets-simplify-project-versioning-with-semantic-releases?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Introducing Changesets: Simplify Project Versioning with Semantic ...</a>)。</p><hr><h2 id="_4-构建与发布优化" tabindex="-1"><a class="header-anchor" href="#_4-构建与发布优化"><span>4. 构建与发布优化</span></a></h2><h3 id="_4-1-针对性构建" tabindex="-1"><a class="header-anchor" href="#_4-1-针对性构建"><span>4.1 针对性构建</span></a></h3><p>在各包 <code>package.json</code> 中添加：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;scripts&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  &quot;prepare&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;npm run build&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>changeset publish</code> 会在发布前自动运行 <code>prepare</code>，只构建有改动的包，无需全量重建 (<a href="https://www.dongbizhen.com/posts/48225/?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">突破项目瓶颈：2024 年Monorepo 工具选择和实践 - BEEZEN</a>)。</p><h3 id="_4-2-turborepo-nx-加速" tabindex="-1"><a class="header-anchor" href="#_4-2-turborepo-nx-加速"><span>4.2 Turborepo/NX 加速</span></a></h3><p>结合 <strong>Turborepo</strong> 或 <strong>NX</strong>，利用缓存和增量构建，只对受影响包执行测试、构建和 lint，加速 CI 流水线 (<a href="https://ksh7.com/posts/workspace-pnpm-turborepo-changesets/index.html?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">使用pnpm、turborepo 构建monorepo 项目，changesets 管理日志和 ...</a>) (<a href="https://yeee.wang/posts/145c.html?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">琢磨一下Monorepo - Yee&#39;s Blog 个人生活网站分享 - 王大白</a>)。</p><hr><h2 id="_5-高级发布策略" tabindex="-1"><a class="header-anchor" href="#_5-高级发布策略"><span>5. 高级发布策略</span></a></h2><h3 id="_5-1-预发布与-snapshot" tabindex="-1"><a class="header-anchor" href="#_5-1-预发布与-snapshot"><span>5.1 预发布与 Snapshot</span></a></h3><ul><li><strong>Beta 预发布</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pre</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> beta</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> publish</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>生成 <code>1.2.0-beta.0</code> 并发布到 <code>beta</code> tag (<a href="https://blog.csdn.net/qq_21567385/article/details/122361591?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">monorepo工作流基础之changesets打开与进阶（Speeches） 原创</a>)。</li><li><strong>Snapshot 发布</strong>：<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --snapshot</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">npx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> changeset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> publish</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div>发布 <code>0.0.0-snapshot-&lt;timestamp&gt;</code>，可用于 E2E 测试，不影响正式版本 (<a href="https://blog.csdn.net/qq_21567385/article/details/122361591?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">monorepo工作流基础之changesets打开与进阶（Speeches） 原创</a>)。</li></ul><h3 id="_5-2-dist-tag-管理" tabindex="-1"><a class="header-anchor" href="#_5-2-dist-tag-管理"><span>5.2 Dist-Tag 管理</span></a></h3><table><thead><tr><th>渠道</th><th>npm dist-tag</th><th>用途</th></tr></thead><tbody><tr><td>稳定版</td><td><code>latest</code></td><td>生产环境默认安装</td></tr><tr><td>次要测试版</td><td><code>beta</code></td><td>QA 或早期体验</td></tr><tr><td>主干 Canary</td><td><code>canary</code></td><td>主干周度或每日构建测试</td></tr></tbody></table><p>CI 可根据版本号自动指定 Dist-Tag，确保用户安装到正确版本 (<a href="https://lirantal.com/blog/introducing-changesets-simplify-project-versioning-with-semantic-releases?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Introducing Changesets: Simplify Project Versioning with Semantic ...</a>)。</p><hr><h2 id="_6-最佳实践" tabindex="-1"><a class="header-anchor" href="#_6-最佳实践"><span>6. 最佳实践</span></a></h2><ol><li><strong>Conventional Commits</strong>：统一提交格式，方便后续工具（如 Semantic Release）自动生成 Changeset (<a href="https://jakeginnivan.medium.com/how-i-use-changesets-for-releases-a4d7dac7671a?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">How I use Changesets for Releases | by Jake Ginnivan - Medium</a>)。</li><li><strong>PR 验证</strong>：在 CI 中运行 <code>pnpm changeset status</code>，检测未发布变更并提示 (<a href="https://github.com/changesets/changesets?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">changesets/changesets: A way to manage your versioning ... - GitHub</a>)。</li><li><strong>严格分支策略</strong>：主干（main）只合并已通过 Review 和 CI 的 PR，发布只在 <code>main</code> 触发 (<a href="https://juejin.cn/post/7276393533086318632?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">在公司项目中使用changesets进行项目管理，提升效率 - 稀土掘金</a>)。</li><li><strong>文档与 Changelog 卫士</strong>：保证 <code>CHANGELOG.md</code> 清晰，只包含重要变更，不要手动改动自动生成区块 (<a href="https://lirantal.com/blog/introducing-changesets-simplify-project-versioning-with-semantic-releases?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">Introducing Changesets: Simplify Project Versioning with Semantic ...</a>)。</li><li><strong>代码检查与测试覆盖</strong>：利用 Turborepo/NX 做增量测试，保持高测试覆盖率，防止发布回归 (<a href="https://ksh7.com/posts/workspace-pnpm-turborepo-changesets/index.html?utm_source=chatgpt.com" target="_blank" rel="noopener noreferrer">使用pnpm、turborepo 构建monorepo 项目，changesets 管理日志和 ...</a>)。</li></ol><hr><p>通过以上实践，企业级团队可在 Monorepo 环境下实现<strong>高度自动化</strong>、<strong>低出错率</strong>和<strong>可追溯</strong>的版本发布流程，让开发者专注于业务实现，而不用操心版本管理和发布细节。</p>`,59)]))}const o=e(t,[["render",l]]),d=JSON.parse('{"path":"/posts/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/changeset.html","title":"changeset","lang":"zh-CN","frontmatter":{"title":"changeset","tags":["前端工程化"],"description":"以下是一份面向企业级 Monorepo 项目的 Changesets 实战手册，涵盖仓库架构、自动化版本管理、CI/CD 集成、构建优化、高级发布策略及最佳实践，全部示例均基于真实开源项目和社区经验整理。 概要 企业级 Monorepo 往往包含上百个包和多个应用，手动维护版本和发布流程极易出错。Changesets 通过在 .changeset/ 目...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/zy-vuepress/posts/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/changeset.html"}],["meta",{"property":"og:site_name","content":"我的基地"}],["meta",{"property":"og:title","content":"changeset"}],["meta",{"property":"og:description","content":"以下是一份面向企业级 Monorepo 项目的 Changesets 实战手册，涵盖仓库架构、自动化版本管理、CI/CD 集成、构建优化、高级发布策略及最佳实践，全部示例均基于真实开源项目和社区经验整理。 概要 企业级 Monorepo 往往包含上百个包和多个应用，手动维护版本和发布流程极易出错。Changesets 通过在 .changeset/ 目..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-04-29T03:37:38.000Z"}],["meta",{"property":"article:tag","content":"前端工程化"}],["meta",{"property":"article:modified_time","content":"2025-04-29T03:37:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"changeset\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-04-29T03:37:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mrs.Zoe\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":2,"title":"概要","slug":"概要","link":"#概要","children":[]},{"level":2,"title":"1. Monorepo 架构设计","slug":"_1-monorepo-架构设计","link":"#_1-monorepo-架构设计","children":[{"level":3,"title":"1.1 典型目录结构","slug":"_1-1-典型目录结构","link":"#_1-1-典型目录结构","children":[]},{"level":3,"title":"1.2 为什么选 Monorepo？","slug":"_1-2-为什么选-monorepo","link":"#_1-2-为什么选-monorepo","children":[]}]},{"level":2,"title":"2. Changesets 自动化版本管理","slug":"_2-changesets-自动化版本管理","link":"#_2-changesets-自动化版本管理","children":[{"level":3,"title":"2.1 安装与初始化","slug":"_2-1-安装与初始化","link":"#_2-1-安装与初始化","children":[]},{"level":3,"title":"2.2 记录变更","slug":"_2-2-记录变更","link":"#_2-2-记录变更","children":[]},{"level":3,"title":"2.3 Bump 版本与生成 Changelog","slug":"_2-3-bump-版本与生成-changelog","link":"#_2-3-bump-版本与生成-changelog","children":[]},{"level":3,"title":"2.4 发布到 npm","slug":"_2-4-发布到-npm","link":"#_2-4-发布到-npm","children":[]}]},{"level":2,"title":"3. CI/CD 集成","slug":"_3-ci-cd-集成","link":"#_3-ci-cd-集成","children":[{"level":3,"title":"3.1 在 PR 中强制检查 Changeset","slug":"_3-1-在-pr-中强制检查-changeset","link":"#_3-1-在-pr-中强制检查-changeset","children":[]},{"level":3,"title":"3.2 自动化 Release Workflow","slug":"_3-2-自动化-release-workflow","link":"#_3-2-自动化-release-workflow","children":[]}]},{"level":2,"title":"4. 构建与发布优化","slug":"_4-构建与发布优化","link":"#_4-构建与发布优化","children":[{"level":3,"title":"4.1 针对性构建","slug":"_4-1-针对性构建","link":"#_4-1-针对性构建","children":[]},{"level":3,"title":"4.2 Turborepo/NX 加速","slug":"_4-2-turborepo-nx-加速","link":"#_4-2-turborepo-nx-加速","children":[]}]},{"level":2,"title":"5. 高级发布策略","slug":"_5-高级发布策略","link":"#_5-高级发布策略","children":[{"level":3,"title":"5.1 预发布与 Snapshot","slug":"_5-1-预发布与-snapshot","link":"#_5-1-预发布与-snapshot","children":[]},{"level":3,"title":"5.2 Dist-Tag 管理","slug":"_5-2-dist-tag-管理","link":"#_5-2-dist-tag-管理","children":[]}]},{"level":2,"title":"6. 最佳实践","slug":"_6-最佳实践","link":"#_6-最佳实践","children":[]}],"git":{"createdTime":1745897858000,"updatedTime":1745897858000,"contributors":[{"name":"zy","username":"zy","email":"891374900@qq.com","commits":1,"url":"https://github.com/zy"}]},"readingTime":{"minutes":5.64,"words":1692},"filePathRelative":"posts/前端工程化/changeset.md","localizedDate":"2025年4月29日","excerpt":"<p>以下是一份面向企业级 Monorepo 项目的 <strong>Changesets 实战手册</strong>，涵盖仓库架构、自动化版本管理、CI/CD 集成、构建优化、高级发布策略及最佳实践，全部示例均基于真实开源项目和社区经验整理。</p>\\n<h2>概要</h2>\\n<p>企业级 Monorepo 往往包含上百个包和多个应用，手动维护版本和发布流程极易出错。<strong>Changesets</strong> 通过在 <code>.changeset/</code> 目录下记录每次变更，结合 CLI 和 GitHub Action，实现了<strong>多包版本自动化管理</strong>、<strong>Changelog 生成</strong>、<strong>Git Tag 打点</strong>和<strong>npm 发布</strong>等全流程自动化，大幅提升团队协作效率和发布安全性  (<a href=\\"https://lirantal.com/blog/introducing-changesets-simplify-project-versioning-with-semantic-releases?utm_source=chatgpt.com\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Introducing Changesets: Simplify Project Versioning with Semantic ...</a>)  (<a href=\\"https://github.com/changesets/changesets?utm_source=chatgpt.com\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">changesets/changesets: A way to manage your versioning ... - GitHub</a>)。</p>","autoDesc":true}');export{o as comp,d as data};
