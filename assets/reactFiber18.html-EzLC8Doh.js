import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,e,o as n}from"./app-DkVa7Hgi.js";const t={};function l(h,i){return n(),a("div",null,i[0]||(i[0]=[e(`<p>å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ç»“åˆ React æºç ï¼ˆä»¥ React 18 ä¸ºä¸»ï¼‰å¯¹ Fiber æ›´æ–°æµç¨‹çš„ä¸“ä¸šã€ç³»ç»Ÿæ€§è§£æã€‚å†…å®¹æ¶µç›– Fiber æ¶æ„ä¸‹æ›´æ–°çš„ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µï¼š<strong>è°ƒåº¦ï¼ˆScheduleï¼‰â†’ æ¸²æŸ“ï¼ˆRenderï¼‰â†’ æäº¤ï¼ˆCommitï¼‰</strong>ï¼Œå¹¶åµŒå…¥å…³é”®æºç å…¥å£ä¸æœ¯è¯­ã€‚</p><hr><h1 id="ğŸ§ -react-fiber-æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -react-fiber-æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£"><span>ğŸ§  React Fiber æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£</span></a></h1><hr><h3 id="âœ…-ä¸€ã€è°ƒåº¦é˜¶æ®µ-schedule-phase" tabindex="-1"><a class="header-anchor" href="#âœ…-ä¸€ã€è°ƒåº¦é˜¶æ®µ-schedule-phase"><span>âœ… ä¸€ã€è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰</span></a></h3><p>è°ƒåº¦é˜¶æ®µçš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š</p><ul><li>å°†æ›´æ–°è¯·æ±‚<strong>æ³¨å†Œä¸ºä¸€ä¸ªä»»åŠ¡</strong>ï¼›</li><li>æŒ‰ç…§ä¼˜å…ˆçº§ï¼ˆLanes æ¨¡å‹ï¼‰å¯¹ä»»åŠ¡è¿›è¡Œç®¡ç†å’Œè°ƒåº¦ï¼›</li><li>è§¦å‘æˆ–åˆå¹¶æ›´æ–°ï¼Œå‡†å¤‡è¿›å…¥æ¸²æŸ“é˜¶æ®µã€‚</li></ul><hr><h4 id="ğŸ”¸-å…¥å£å‡½æ•°-scheduleupdateonfiber" tabindex="-1"><a class="header-anchor" href="#ğŸ”¸-å…¥å£å‡½æ•°-scheduleupdateonfiber"><span>ğŸ”¸ å…¥å£å‡½æ•°ï¼š<code>scheduleUpdateOnFiber</code></span></a></h4><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// packages/react-reconciler/src/ReactFiberWorkLoop.new.ts</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> scheduleUpdateOnFiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">fiber</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Fiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">lane</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Lane</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">eventTime</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;"> number</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // æ ‡è®°æ›´æ–°çš„ lane</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  markUpdateLaneFromFiberToRoot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">fiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">lane</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> root</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> markRootUpdated</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">fiberRoot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">lane</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">eventTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  ensureRootIsScheduled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">eventTime</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ”¸-å…³é”®ç‚¹è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#ğŸ”¸-å…³é”®ç‚¹è§£é‡Š"><span>ğŸ”¸ å…³é”®ç‚¹è§£é‡Šï¼š</span></a></h4><ul><li><strong>Fiber èŠ‚ç‚¹ï¼ˆFiberNodeï¼‰</strong>ï¼šè¡¨ç¤ºç»„ä»¶æ ‘ä¸Šçš„æ¯ä¸€ä¸ªå•å…ƒï¼›</li><li><strong>Laneï¼ˆè½¦é“æ¨¡å‹ï¼‰</strong>ï¼šä»£æ›¿ä¼˜å…ˆçº§ï¼Œç”¨ä½å›¾è¡¨ç¤ºå¤šä¸ªä¼˜å…ˆçº§æ›´æ–°å¹¶å­˜ï¼›</li><li><strong>ReactEventLoop / Scheduler</strong>ï¼šåè°ƒå¤šä¸ªä¼˜å…ˆçº§ä»»åŠ¡ï¼Œæ”¯æŒæ—¶é—´åˆ‡ç‰‡ã€‚</li></ul><hr><h3 id="âœ…-äºŒã€æ¸²æŸ“é˜¶æ®µ-render-phase-æˆ–-reconciliation" tabindex="-1"><a class="header-anchor" href="#âœ…-äºŒã€æ¸²æŸ“é˜¶æ®µ-render-phase-æˆ–-reconciliation"><span>âœ… äºŒã€æ¸²æŸ“é˜¶æ®µï¼ˆRender Phaseï¼Œæˆ– Reconciliationï¼‰</span></a></h3><p>ç›®æ ‡æ˜¯<strong>æ„å»ºæ–°çš„ Fiber æ ‘ï¼ˆworkInProgressï¼‰</strong>ï¼ŒåŒæ—¶é€šè¿‡ diff æ¯”è¾ƒæ‰¾å‡ºå˜åŒ–ï¼ˆå‰¯ä½œç”¨ï¼‰ï¼Œæ”¶é›†åˆ° effectListã€‚</p><p>æ­¤é˜¶æ®µæ˜¯<strong>å¯ä¸­æ–­çš„ã€å¼‚æ­¥æ‰§è¡Œçš„</strong>ï¼Œå³ä½¿ç”¨ Fiber åç¨‹ + requestIdleCallback/Scheduler å¼‚æ­¥è°ƒåº¦ã€‚</p><hr><h4 id="ğŸ”¸-æ ¸å¿ƒå‡½æ•°-workloopconcurrent" tabindex="-1"><a class="header-anchor" href="#ğŸ”¸-æ ¸å¿ƒå‡½æ•°-workloopconcurrent"><span>ğŸ”¸ æ ¸å¿ƒå‡½æ•°ï¼š<code>workLoopConcurrent</code></span></a></h4><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> workLoopConcurrent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  while</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">workInProgress</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">shouldYield</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">()) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    performUnitOfWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">workInProgress</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ”¸-æ¸²æŸ“é˜¶æ®µæ ¸å¿ƒæµç¨‹" tabindex="-1"><a class="header-anchor" href="#ğŸ”¸-æ¸²æŸ“é˜¶æ®µæ ¸å¿ƒæµç¨‹"><span>ğŸ”¸ æ¸²æŸ“é˜¶æ®µæ ¸å¿ƒæµç¨‹ï¼š</span></a></h4><ol><li>ä» <code>workInProgress</code> å¼€å§‹æ·±åº¦éå† Fiber æ ‘ï¼›</li><li>è°ƒç”¨ <code>beginWork()</code> æ„å»ºå­ Fiberï¼›</li><li>å›æº¯è§¦å‘ <code>completeWork()</code>ï¼›</li><li>æ„å»º EffectListï¼ˆå‰¯ä½œç”¨åˆ—è¡¨ï¼‰ã€‚</li></ol><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> performUnitOfWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">unitOfWork</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Fiber</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#0184BC;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> current</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> unitOfWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">alternate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  let</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> next</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> beginWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">current</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">unitOfWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">renderLanes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;">  unitOfWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">memoizedProps</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E5C07B;"> unitOfWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">pendingProps</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">next</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    completeUnitOfWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">unitOfWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">    workInProgress</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;"> next</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ”¸-æŠ€æœ¯äº®ç‚¹" tabindex="-1"><a class="header-anchor" href="#ğŸ”¸-æŠ€æœ¯äº®ç‚¹"><span>ğŸ”¸ æŠ€æœ¯äº®ç‚¹ï¼š</span></a></h4><ul><li><strong>åŒç¼“å­˜ Fiber æ ‘æœºåˆ¶</strong>ï¼šcurrent / workInProgressï¼›</li><li><strong>æ—¶é—´åˆ‡ç‰‡ï¼ˆTime Slicingï¼‰</strong>ï¼šé€šè¿‡ <code>shouldYield()</code> å®ç°å¯ä¸­æ–­ï¼›</li><li><strong>ä¼˜å…ˆçº§é©±åŠ¨</strong>ï¼šåŸºäº <code>Lane</code> è¿›è¡Œä»»åŠ¡è°ƒåº¦ï¼›</li><li><strong>é€’å½’ â†’ åç¨‹æ¨¡å¼</strong>ï¼šé¿å…æµè§ˆå™¨é•¿ä»»åŠ¡å¡é¡¿ã€‚</li></ul><hr><h3 id="âœ…-ä¸‰ã€æäº¤é˜¶æ®µ-commit-phase" tabindex="-1"><a class="header-anchor" href="#âœ…-ä¸‰ã€æäº¤é˜¶æ®µ-commit-phase"><span>âœ… ä¸‰ã€æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰</span></a></h3><p>æ­¤é˜¶æ®µä¼šåŒæ­¥æ‰§è¡Œæ”¶é›†åˆ°çš„å‰¯ä½œç”¨æ“ä½œï¼ˆEffectï¼‰ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>æ’å…¥ / æ›´æ–° / åˆ é™¤ DOMï¼›</li><li>æ‰§è¡Œç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ <code>componentDidMount</code>ï¼‰ï¼›</li><li>è°ƒç”¨ refï¼›</li><li>å¯åŠ¨ layout effectã€‚</li></ul><hr><h4 id="ğŸ”¸-æäº¤å…¥å£-commitroot" tabindex="-1"><a class="header-anchor" href="#ğŸ”¸-æäº¤å…¥å£-commitroot"><span>ğŸ”¸ æäº¤å…¥å£ï¼š<code>commitRoot</code></span></a></h4><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> commitRoot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">root</span><span style="--shiki-light:#0184BC;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> FiberRoot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // æ‰§è¡Œ beforeMutationã€mutationã€layout ä¸‰ä¸ªé˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  commitBeforeMutationEffects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  commitMutationEffects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">finishedWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">  commitLayoutEffects</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">root</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-dark:#E06C75;">finishedWork</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ”¸-æŠ€æœ¯ç‰¹ç‚¹" tabindex="-1"><a class="header-anchor" href="#ğŸ”¸-æŠ€æœ¯ç‰¹ç‚¹"><span>ğŸ”¸ æŠ€æœ¯ç‰¹ç‚¹ï¼š</span></a></h4><ul><li><strong>åŒæ­¥æ‰§è¡Œã€ä¸å¯ä¸­æ–­</strong>ï¼›</li><li>Effect list æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ŒæŒ‰é¡ºåºå¤„ç†ï¼›</li><li>ç»“æ„æ¸…æ™°åˆ†ä¸‰æ®µï¼ˆBeforeMutation â†’ Mutation â†’ Layoutï¼‰ï¼›</li><li>DOM æ“ä½œå‘ç”Ÿåœ¨ <code>Mutation</code> é˜¶æ®µï¼Œå‰¯ä½œç”¨ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œåœ¨ <code>Layout</code>ã€‚</li></ul><hr><h2 id="ğŸ“Œ-fiber-æ¶æ„æ€»ç»“æœ¯è¯­" tabindex="-1"><a class="header-anchor" href="#ğŸ“Œ-fiber-æ¶æ„æ€»ç»“æœ¯è¯­"><span>ğŸ“Œ Fiber æ¶æ„æ€»ç»“æœ¯è¯­</span></a></h2><table><thead><tr><th>æ¦‚å¿µ</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>FiberNode</td><td>æ¯ä¸ª React å…ƒç´ å¯¹åº”çš„å·¥ä½œå•å…ƒï¼›</td></tr><tr><td>Fiber Tree</td><td>æ•´æ£µç»„ä»¶æ ‘åœ¨å†…å­˜ä¸­çš„è¡¨ç¤ºç»“æ„ï¼›</td></tr><tr><td>workInProgress</td><td>æ­£åœ¨æ„å»ºçš„ Fiber Treeï¼›</td></tr><tr><td>current</td><td>å½“å‰æ­£åœ¨æ˜¾ç¤ºçš„ Fiber Treeï¼›</td></tr><tr><td>Lanes</td><td>ä¼˜å…ˆçº§æ¨¡å‹ï¼Œæ”¯æŒå¤šä¸ªæ›´æ–°å¹¶å‘ï¼›</td></tr><tr><td>Scheduler</td><td>åŸºäºä¼˜å…ˆçº§çš„ä»»åŠ¡è°ƒåº¦å™¨ï¼›</td></tr><tr><td>shouldYield</td><td>ç”¨äºå®ç°æ—¶é—´åˆ‡ç‰‡çš„ä¸­æ–­åˆ¤æ–­å‡½æ•°ï¼›</td></tr><tr><td>EffectList</td><td>è®°å½•éœ€è¦è¢«æäº¤çš„å‰¯ä½œç”¨é“¾è¡¨ï¼›</td></tr><tr><td>beginWork</td><td>åè°ƒé˜¶æ®µå…¥å£ï¼Œæ‰§è¡Œ diff å’Œæ–°èŠ‚ç‚¹æ„å»ºï¼›</td></tr><tr><td>completeWork</td><td>æ„å»º DOM ç»“æ„å’Œå‰¯ä½œç”¨åˆ—è¡¨ï¼›</td></tr><tr><td>commitRoot</td><td>æœ€ç»ˆå°†æ›´æ–°æäº¤åˆ°æµè§ˆå™¨ DOMã€‚</td></tr></tbody></table><hr><h2 id="ğŸ“Š-æ›´æ–°æµç¨‹å›¾æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-æ›´æ–°æµç¨‹å›¾æ¦‚è§ˆ"><span>ğŸ“Š æ›´æ–°æµç¨‹å›¾æ¦‚è§ˆ</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>ç”¨æˆ·è§¦å‘ setState / dispatch</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>scheduleUpdateOnFiber</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>Scheduler è°ƒåº¦ä»»åŠ¡ï¼ˆä¸åŒ Lanesï¼‰</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>render é˜¶æ®µï¼ˆbeginWork / completeWorkï¼‰</span></span>
<span class="line"><span>        â†“ï¼ˆå¯ä¸­æ–­ï¼‰</span></span>
<span class="line"><span>ç”Ÿæˆ workInProgress Tree + EffectList</span></span>
<span class="line"><span>        â†“</span></span>
<span class="line"><span>commit é˜¶æ®µï¼ˆcommitRootï¼‰</span></span>
<span class="line"><span>        â†“ï¼ˆåŒæ­¥ï¼‰</span></span>
<span class="line"><span>æ›´æ–°çœŸå® DOMï¼Œæ‰§è¡Œå‰¯ä½œç”¨</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>`,40)]))}const k=s(t,[["render",l]]),d=JSON.parse('{"path":"/posts/react/reactFiber18.html","title":"ğŸ§  React Fiber æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£","lang":"zh-CN","frontmatter":{"description":"å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ç»“åˆ React æºç ï¼ˆä»¥ React 18 ä¸ºä¸»ï¼‰å¯¹ Fiber æ›´æ–°æµç¨‹çš„ä¸“ä¸šã€ç³»ç»Ÿæ€§è§£æã€‚å†…å®¹æ¶µç›– Fiber æ¶æ„ä¸‹æ›´æ–°çš„ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µï¼šè°ƒåº¦ï¼ˆScheduleï¼‰â†’ æ¸²æŸ“ï¼ˆRenderï¼‰â†’ æäº¤ï¼ˆCommitï¼‰ï¼Œå¹¶åµŒå…¥å…³é”®æºç å…¥å£ä¸æœ¯è¯­ã€‚ ğŸ§  React Fiber æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£ âœ… ä¸€ã€è°ƒåº¦é˜¶æ®µï¼ˆSchedule Ph...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/zy-vuepress/posts/react/reactFiber18.html"}],["meta",{"property":"og:site_name","content":"æˆ‘çš„åŸºåœ°"}],["meta",{"property":"og:title","content":"ğŸ§  React Fiber æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£"}],["meta",{"property":"og:description","content":"å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ç»“åˆ React æºç ï¼ˆä»¥ React 18 ä¸ºä¸»ï¼‰å¯¹ Fiber æ›´æ–°æµç¨‹çš„ä¸“ä¸šã€ç³»ç»Ÿæ€§è§£æã€‚å†…å®¹æ¶µç›– Fiber æ¶æ„ä¸‹æ›´æ–°çš„ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µï¼šè°ƒåº¦ï¼ˆScheduleï¼‰â†’ æ¸²æŸ“ï¼ˆRenderï¼‰â†’ æäº¤ï¼ˆCommitï¼‰ï¼Œå¹¶åµŒå…¥å…³é”®æºç å…¥å£ä¸æœ¯è¯­ã€‚ ğŸ§  React Fiber æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£ âœ… ä¸€ã€è°ƒåº¦é˜¶æ®µï¼ˆSchedule Ph..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-05-09T11:25:45.000Z"}],["meta",{"property":"article:modified_time","content":"2025-05-09T11:25:45.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ğŸ§  React Fiber æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-05-09T11:25:45.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mrs.Zoe\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[{"level":3,"title":"âœ… ä¸€ã€è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰","slug":"âœ…-ä¸€ã€è°ƒåº¦é˜¶æ®µ-schedule-phase","link":"#âœ…-ä¸€ã€è°ƒåº¦é˜¶æ®µ-schedule-phase","children":[]},{"level":3,"title":"âœ… äºŒã€æ¸²æŸ“é˜¶æ®µï¼ˆRender Phaseï¼Œæˆ– Reconciliationï¼‰","slug":"âœ…-äºŒã€æ¸²æŸ“é˜¶æ®µ-render-phase-æˆ–-reconciliation","link":"#âœ…-äºŒã€æ¸²æŸ“é˜¶æ®µ-render-phase-æˆ–-reconciliation","children":[]},{"level":3,"title":"âœ… ä¸‰ã€æäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰","slug":"âœ…-ä¸‰ã€æäº¤é˜¶æ®µ-commit-phase","link":"#âœ…-ä¸‰ã€æäº¤é˜¶æ®µ-commit-phase","children":[]},{"level":2,"title":"ğŸ“Œ Fiber æ¶æ„æ€»ç»“æœ¯è¯­","slug":"ğŸ“Œ-fiber-æ¶æ„æ€»ç»“æœ¯è¯­","link":"#ğŸ“Œ-fiber-æ¶æ„æ€»ç»“æœ¯è¯­","children":[]},{"level":2,"title":"ğŸ“Š æ›´æ–°æµç¨‹å›¾æ¦‚è§ˆ","slug":"ğŸ“Š-æ›´æ–°æµç¨‹å›¾æ¦‚è§ˆ","link":"#ğŸ“Š-æ›´æ–°æµç¨‹å›¾æ¦‚è§ˆ","children":[]}],"git":{"createdTime":1746789945000,"updatedTime":1746789945000,"contributors":[{"name":"zouyu","username":"zouyu","email":"891374900@qq.com","commits":1,"url":"https://github.com/zouyu"}]},"readingTime":{"minutes":2.61,"words":784},"filePathRelative":"posts/react/reactFiber18.md","localizedDate":"2025å¹´5æœˆ9æ—¥","excerpt":"<p>å½“ç„¶å¯ä»¥ï¼Œä»¥ä¸‹æ˜¯ç»“åˆ React æºç ï¼ˆä»¥ React 18 ä¸ºä¸»ï¼‰å¯¹ Fiber æ›´æ–°æµç¨‹çš„ä¸“ä¸šã€ç³»ç»Ÿæ€§è§£æã€‚å†…å®¹æ¶µç›– Fiber æ¶æ„ä¸‹æ›´æ–°çš„ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µï¼š<strong>è°ƒåº¦ï¼ˆScheduleï¼‰â†’ æ¸²æŸ“ï¼ˆRenderï¼‰â†’ æäº¤ï¼ˆCommitï¼‰</strong>ï¼Œå¹¶åµŒå…¥å…³é”®æºç å…¥å£ä¸æœ¯è¯­ã€‚</p>\\n<hr>\\n<h1>ğŸ§  React Fiber æ¶æ„ä¸‹çš„æ›´æ–°æµç¨‹è¯¦è§£</h1>\\n<hr>\\n<h3>âœ… ä¸€ã€è°ƒåº¦é˜¶æ®µï¼ˆSchedule Phaseï¼‰</h3>\\n<p>è°ƒåº¦é˜¶æ®µçš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š</p>\\n<ul>\\n<li>å°†æ›´æ–°è¯·æ±‚<strong>æ³¨å†Œä¸ºä¸€ä¸ªä»»åŠ¡</strong>ï¼›</li>\\n<li>æŒ‰ç…§ä¼˜å…ˆçº§ï¼ˆLanes æ¨¡å‹ï¼‰å¯¹ä»»åŠ¡è¿›è¡Œç®¡ç†å’Œè°ƒåº¦ï¼›</li>\\n<li>è§¦å‘æˆ–åˆå¹¶æ›´æ–°ï¼Œå‡†å¤‡è¿›å…¥æ¸²æŸ“é˜¶æ®µã€‚</li>\\n</ul>","autoDesc":true}');export{k as comp,d as data};
