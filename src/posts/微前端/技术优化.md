---
title: å¾®å‰ç«¯æŠ€æœ¯ä¼˜åŒ–
tags:
  - å¾®å‰ç«¯
---


1. âœ… **é¢„åŠ è½½**
2. âœ… **èµ„æºå…±äº«**
3. âœ… **å­åº”ç”¨ç¼“å­˜ï¼ˆKeepAliveï¼‰**
4. âœ… **ä¸æ»‘è½¬åœºï¼ˆè¿‡æ¸¡åŠ¨ç”»ï¼‰**
5. âœ… **å®Œæ•´ DEMO ç¤ºä¾‹**

---

## ğŸ“¦ ä¾èµ–å®‰è£…

```bash
npm install micro-app
```

```ts
// main.ts (ä¸»åº”ç”¨å…¥å£)
import { createApp } from 'vue'
import App from './App.vue'
import microApp from '@micro-zoe/micro-app'

microApp.start() // å¯åŠ¨ micro-app

createApp(App).mount('#app')
```

---

## 1ï¸âƒ£ é¢„åŠ è½½å­åº”ç”¨èµ„æºï¼ˆæå‰åŠ è½½å­åº”ç”¨ï¼‰

### âœ… ç¤ºä¾‹ï¼šé¢„åŠ è½½ä¸€ä¸ªå­åº”ç”¨

```ts
import microApp from '@micro-zoe/micro-app'

// é¢„åŠ è½½ï¼šå­åº”ç”¨åœ¨æœªæ¥å¯èƒ½ä¼šè¢«è®¿é—®ï¼Œå…ˆåŠ è½½é™æ€èµ„æº
microApp.preFetch([
  { name: 'sub-vue', url: 'http://localhost:7100/' },
  { name: 'sub-react', url: 'http://localhost:7200/' }
])
```

> ğŸ”¥ æå‰é¢„çƒ­ï¼ŒåŠ å¿«ç”¨æˆ·é¦–æ¬¡è®¿é—®é€Ÿåº¦ï¼

---

## 2ï¸âƒ£ å­åº”ç”¨èµ„æºå…±äº«ï¼ˆå‡å°‘é‡å¤åŠ è½½ï¼‰


### âœ… ä¸»åº”ç”¨ HTML åŠ è½½ Vueï¼Œè®¾ç½®å…±äº«
- æ–¹å¼ä¸€ã€globalAssets
globalAssetsç”¨äºè®¾ç½®å…¨å±€å…±äº«èµ„æºï¼Œå®ƒå’Œé¢„åŠ è½½çš„æ€è·¯ç›¸åŒï¼Œåœ¨æµè§ˆå™¨ç©ºé—²æ—¶åŠ è½½èµ„æºå¹¶æ”¾å…¥ç¼“å­˜ã€‚

å½“å­åº”ç”¨åŠ è½½ç›¸åŒåœ°å€çš„jsæˆ–cssèµ„æºæ—¶ï¼Œä¼šç›´æ¥ä»ç¼“å­˜ä¸­æå–æ•°æ®ï¼Œä»è€Œæå‡æ¸²æŸ“é€Ÿåº¦ã€‚

ä½¿ç”¨æ–¹å¼

```js

// index.js
import microApp from '@micro-zoe/micro-app'

microApp.start({
  globalAssets: {
    js: ['jsåœ°å€1', 'https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.min.js', ...], // jsåœ°å€, // jsåœ°å€
    css: ['cssåœ°å€1', 'cssåœ°å€2', ...], // cssåœ°å€
  }
})

// å­åº”ç”¨

export default defineConfig({
  build: {
    rollupOptions: {
      external: ['vue']
    }
  }
})
```
- æ–¹å¼äºŒã€global å±æ€§

åœ¨linkã€scriptè®¾ç½®globalå±æ€§ä¼šå°†æ–‡ä»¶æå–ä¸ºå…¬å…±æ–‡ä»¶ï¼Œå…±äº«ç»™å…¶å®ƒåº”ç”¨ã€‚

è®¾ç½®globalå±æ€§åæ–‡ä»¶ç¬¬ä¸€æ¬¡åŠ è½½ä¼šæ”¾å…¥å…¬å…±ç¼“å­˜ï¼Œå…¶å®ƒå­åº”ç”¨åŠ è½½ç›¸åŒçš„èµ„æºæ—¶ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–å†…å®¹ï¼Œä»è€Œæå‡æ¸²æŸ“é€Ÿåº¦ã€‚

ä½¿ç”¨æ–¹å¼

```js

<link rel="stylesheet" href="xx.css" global>
<script src="xx.js" global></script>

```

---

## 3ï¸âƒ£ å­åº”ç”¨ç¼“å­˜ï¼ˆKeepAliveï¼‰

### âœ… ç¤ºä¾‹ï¼šç¼“å­˜å­åº”ç”¨ï¼Œåˆ‡æ¢è·¯ç”±ä¸é”€æ¯

```vue
<template>
  <div>
    <micro-app
      name="sub-vue"
      url="http://localhost:7100/"
      :keep-alive="true"
      baseroute="/sub-vue"
    />
  </div>
</template>
```

> ğŸ§  keep-alive = true æ—¶ï¼Œå­åº”ç”¨ DOM ä¿ç•™ä¸é”€æ¯ï¼Œæé«˜åˆ‡æ¢é€Ÿåº¦ï¼Œé€‚åˆ Tab åº”ç”¨åœºæ™¯ã€‚

---

## 4ï¸âƒ£ ä¸æ»‘è½¬åœºåŠ¨ç”»

### âœ… åŠ  CSS åŠ¨ç”»å®ç°å…¥åœº/å‡ºåœºæ•ˆæœ

```vue
<template>
  <transition name="fade">
    <micro-app
      v-if="showApp"
      name="sub-vue"
      url="http://localhost:7100/"
      :keep-alive="true"
      baseroute="/sub-vue"
    />
  </transition>
</template>

<script setup>
import { ref } from 'vue'
const showApp = ref(true)
</script>

<style>
.fade-enter-active, .fade-leave-active {
  transition: opacity 0.3s ease;
}
.fade-enter-from, .fade-leave-to {
  opacity: 0;
}
</style>
```

> ğŸš€ åŠ¨ç”»ç»“åˆ keep-alive å®ç°æ›´ä¸æ»‘çš„ç”¨æˆ·ä½“éªŒã€‚

---

## 5ï¸âƒ£ å®Œæ•´ä¸»åº”ç”¨ DEMOï¼ˆæ•´åˆé¢„åŠ è½½ + ç¼“å­˜ + åŠ¨ç”»ï¼‰

```vue
<!-- App.vue -->
<template>
  <div>
    <button @click="toggleApp">åˆ‡æ¢å­åº”ç”¨</button>
    <transition name="fade">
      <micro-app
        v-if="show"
        name="sub-vue"
        url="http://localhost:7100/"
        baseroute="/sub-vue"
        :keep-alive="true"
      />
    </transition>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import microApp from '@micro-zoe/micro-app'

const show = ref(true)

function toggleApp() {
  show.value = !show.value
}

onMounted(() => {
  microApp.preFetch([
    { name: 'sub-vue', url: 'http://localhost:7100/' }
  ])
})
</script>

<style>
.fade-enter-active, .fade-leave-active {
  transition: opacity 0.3s ease;
}
.fade-enter-from, .fade-leave-to {
  opacity: 0;
}
</style>
```

---

## âœ… æœ€ä½³å®è·µå»ºè®®

| åœºæ™¯        | ä¼˜åŒ–å»ºè®®                                   |
| --------- | -------------------------------------- |
| é¦–æ¬¡è®¿é—®æ…¢     | ä½¿ç”¨ `preFetch` æå‰åŠ è½½èµ„æº                   |
| èµ„æºä½“ç§¯å¤§     | ä¸»å­åº”ç”¨å…±äº« CDN ä¾èµ–                          |
| å­åº”ç”¨é¢‘ç¹åˆ‡æ¢   | å¼€å¯ `keep-alive` ä¿æŒç¼“å­˜                   |
| é¡µé¢åˆ‡æ¢ä¸æµç•…   | `transition` + `keep-alive` åŠ åŠ¨ç”»        |
| å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ | ä½¿ç”¨ `microApp.start({ lifeCycles })` é…ç½® |

---



---

## âœ… micro-app è¿›é˜¶ä¼˜åŒ–ç‚¹æ±‡æ€»

| ä¼˜åŒ–ç‚¹              | è¯´æ˜                    |
| ---------------- | --------------------- |
| âœ… åŠ¨æ€æƒé™åŠ è½½         | å­åº”ç”¨æŒ‰æƒé™æ§åˆ¶æ˜¯å¦åŠ è½½          |
| âœ… æ²™ç®±æ€§èƒ½ä¼˜åŒ–         | å…³é—­éå¿…è¦éš”ç¦»é¡¹æé«˜è¿è¡Œæ•ˆç‡        |
| âœ… å…¨å±€çŠ¶æ€é€šä¿¡         | ä¸»å­åº”ç”¨ä¹‹é—´å…±äº«çŠ¶æ€ã€å“åº”å¼é€šä¿¡      |
| âœ… èµ„æºç¼“å­˜ç­–ç•¥         | ç¦»çº¿ç¼“å­˜ï¼Œæˆ–æœ¬åœ°å­˜å‚¨å­åº”ç”¨é™æ€èµ„æº     |
| âœ… å­åº”ç”¨æ‡’åŠ è½½         | åªåœ¨è®¿é—®æ—¶åŠ è½½å­åº”ç”¨ï¼ŒèŠ‚çœåˆå§‹åŒ–èµ„æº    |
| âœ… å­åº”ç”¨é™çº§æœºåˆ¶        | å­åº”ç”¨åŠ è½½å¤±è´¥æ—¶ä½¿ç”¨é™çº§ HTML æˆ–æç¤º |
| âœ… å­åº”ç”¨ Loading å ä½ | åŠ è½½ä¸­æ˜¾ç¤ºåŠ¨ç”»ï¼Œæé«˜ç”¨æˆ·ä½“éªŒ        |
| âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†         | ä¸»åº”ç”¨æ‹¦æˆªå­åº”ç”¨çš„ JS/åŠ è½½é”™è¯¯ç»Ÿä¸€ä¸ŠæŠ¥ |
| âœ… å­åº”ç”¨å¸è½½æ¸…ç†        | ç¦»å¼€é¡µé¢æ—¶æ¸…ç†å…¨å±€äº‹ä»¶ã€å®šæ—¶å™¨ç­‰èµ„æº    |
| âœ… å­åº”ç”¨è®¿é—®æ§åˆ¶        | ç¦æ­¢æŸäº›è§’è‰²è®¿é—®å­åº”ç”¨ï¼Œå¢å¼ºå®‰å…¨æ€§     |

---

## ğŸ” è¯¦ç»†ç¤ºä¾‹ä¸å»ºè®®

### 1ï¸âƒ£ åŠ¨æ€æƒé™åŠ è½½å­åº”ç”¨

```ts
const apps = [
  {
    name: 'admin-app',
    url: 'http://localhost:7100/',
    roles: ['admin']
  },
  {
    name: 'user-app',
    url: 'http://localhost:7200/',
    roles: ['user', 'admin']
  }
]

const userRole = 'user'

const visibleApps = apps.filter(app => app.roles.includes(userRole))
```

---

### 2ï¸âƒ£ ä¼˜åŒ–æ²™ç®±é…ç½®

å¦‚æœä½ ä¸éœ€è¦ä¸¥æ ¼çš„éš”ç¦»ï¼ˆæ¯”å¦‚åªåŠ è½½é™æ€é¡µé¢ï¼‰ï¼Œå¯ä»¥å…³é—­éƒ¨åˆ†éš”ç¦»ï¼š

```ts
microApp.start({
  sandbox: {
    strictStyleIsolation: false, // å°‘ç”¨ ShadowDOM æå‡æ€§èƒ½
    disableFakeBody: true        // ç¦ç”¨ä»£ç† bodyï¼Œå‡å°‘å†…å­˜æ¶ˆè€—
  }
})
```

---

### 3ï¸âƒ£ å…¨å±€çŠ¶æ€å…±äº«é€šä¿¡ï¼ˆä¸»å­åº”ç”¨ï¼‰

```ts
// ä¸»åº”ç”¨
microApp.setGlobalData({ token: 'xxx' })

// å­åº”ç”¨ç›‘å¬æ•°æ®å˜åŒ–
window.microApp?.addDataListener((data) => {
  console.log('ä¸»åº”ç”¨ä¼ æ¥æ•°æ®:', data)
})
```

---

### 4ï¸âƒ£ å­åº”ç”¨æ‡’åŠ è½½ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰

```vue
<template>
  <micro-app
    v-if="hasPermission"
    name="sub-vue"
    url="http://localhost:7100/"
    baseroute="/sub-vue"
  />
</template>
```

---

### 5ï¸âƒ£ å­åº”ç”¨åŠ è½½å¤±è´¥é™çº§æœºåˆ¶

```vue
<template>
  <micro-app
    name="sub-vue"
    url="http://localhost:7100/"
    @error="handleError"
  />
</template>

<script setup>
function handleError(e) {
  console.warn('å­åº”ç”¨åŠ è½½å¤±è´¥', e)
  // æç¤ºç”¨æˆ· æˆ– æ˜¾ç¤ºæœ¬åœ° HTML ç»„ä»¶
}
</script>
```

---

### 6ï¸âƒ£ å­åº”ç”¨ Loading æç¤º

```vue
<template>
  <div>
    <div v-if="loading">å­åº”ç”¨åŠ è½½ä¸­...</div>
    <micro-app
      name="sub-vue"
      url="http://localhost:7100/"
      @mounted="loading = false"
      @error="loading = false"
    />
  </div>
</template>

<script setup>
import { ref } from 'vue'
const loading = ref(true)
</script>
```

---

### 7ï¸âƒ£ å­åº”ç”¨æ¸…ç†å‰¯ä½œç”¨ï¼ˆå†…å­˜æ³„æ¼é¢„é˜²ï¼‰

å­åº”ç”¨ä¸­ï¼š

```ts
// ç›‘å¬ä¸»åº”ç”¨å¸è½½äº‹ä»¶
window.addEventListener('unmount', () => {
  clearInterval(timer)
  window.removeEventListener('scroll', handleScroll)
})
```

---

## ğŸ§  è¡¥å……å»ºè®®

* âœ… å­åº”ç”¨å¯é…åˆ Vite + import.meta.env å®ç°ç¯å¢ƒåˆ‡æ¢
* âœ… ä½¿ç”¨ CDN åŠ é€Ÿå­åº”ç”¨é™æ€èµ„æºåŠ è½½
* âœ… Nginx æ”¯æŒä¸»å­åº”ç”¨åˆ†è·¯å¾„éƒ¨ç½²ï¼ˆå¦‚ `/main/`, `/sub-vue/`ï¼‰
* âœ… æ¨èä¸»å­åº”ç”¨ä½¿ç”¨ç»Ÿä¸€çš„ UI åº“ç‰ˆæœ¬ï¼ˆé¿å…æ ·å¼å†²çªï¼‰

---

