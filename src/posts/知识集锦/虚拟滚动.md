---
title: 虚拟滚动
tags:
   - 虚拟滚动
---


在 Vue 3 中实现 **虚拟滚动（Virtual Scroll）列表** 来高效渲染海量数据时，我们可以通过以下核心策略完成：

---

## ✅ 实现目标

* 渲染超大列表数据（如 1 万条）
* 实际 DOM 中只渲染**可视区域 + 缓冲区**的条目
* 动态计算容器高度，使滚动条正确工作

---

## 🧱 核心思路

1. **设置固定高度的容器（有滚动条）**
2. **根据滚动位置计算可见区域的 item 索引**
3. **只渲染该区域的数据**
4. **使用 padding 占位来保持滚动条正确**
5. **若每个 item 高度不一样：需提前计算或记录每一项高度**

---

## ✅ 示例（固定高度 item）

这是最简单的虚拟列表实现（每个 item 高度相同）：

```vue
<template>
  <div
    class="virtual-list"
    ref="containerRef"
    @scroll="onScroll"
    :style="{ height: containerHeight + 'px', overflowY: 'auto' }"
  >
    <div :style="{ height: totalHeight + 'px', position: 'relative' }">
      <div
        v-for="item in visibleItems"
        :key="item.id"
        :style="{
          position: 'absolute',
          top: item.index * itemHeight + 'px',
          height: itemHeight + 'px',
          width: '100%',
          boxSizing: 'border-box',
          borderBottom: '1px solid #eee'
        }"
      >
        {{ item.text }}
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue';

const itemHeight = 40;
const containerHeight = 400;
const buffer = 5;

const items = Array.from({ length: 10000 }, (_, i) => ({
  id: i,
  text: `Item ${i}`,
  index: i
}));

const containerRef = ref(null);
const scrollTop = ref(0);

const totalHeight = items.length * itemHeight;

const visibleCount = Math.ceil(containerHeight / itemHeight) + buffer * 2;

const start = computed(() =>
  Math.max(Math.floor(scrollTop.value / itemHeight) - buffer, 0)
);

const end = computed(() =>
  Math.min(start.value + visibleCount, items.length)
);

const visibleItems = computed(() => items.slice(start.value, end.value));

function onScroll(e) {
  scrollTop.value = e.target.scrollTop;
}
</script>
```

---

## ✅ 动态高度实现（难点）

如果每个 item 高度不一致，需动态测量：

### 思路：

1. 初始渲染前 N 条记录它们真实高度
2. 构建 `index -> offsetTop` 的映射
3. 滚动时二分查找出当前 scrollTop 属于哪个 item
4. 渲染可视区 + padding 占位

---

### 建议使用成熟库

实现动态高度的虚拟列表需要复杂计算，一般推荐使用社区成熟组件：

* [Vue Virtual Scroller](https://github.com/Akryum/vue-virtual-scroller) ✅ 支持动态高度 + 滚动容器
* [Virtuoso (for Vue)](https://virtuoso.dev/vue/) 🚀 支持动态内容、表格、无限滚动等

---

## 🧠 总结

| 特性       | 实现方式                                  |
| -------- | ------------------------------------- |
| 固定高度虚拟滚动 | 计算 index → slice 可视数据，padding 占位      |
| 动态高度虚拟滚动 | 记录每项高度 → 维护 offset 索引表 → 二分查找         |
| 推荐做法     | 使用成熟库（如 `vue-virtual-scroller`）节省维护成本 |

