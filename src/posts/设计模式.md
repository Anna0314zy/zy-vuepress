---
title: è®¾è®¡æ¨¡å¼
date: 2020-04-19
tags:
  - Javascript
  - è®¾è®¡æ¨¡å¼
---


### ğŸ“Œ å•ä¾‹æ¨¡å¼ 

> å¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°åˆ›å»ºå•ä¾‹

## é€šè¿‡ getInstance
::: danger
é—®é¢˜ å¦‚æœæ˜¯js æ²¡æœ‰åŠæ³•å¼ºåˆ¶è¦æ±‚ç”¨æˆ· ä¸€å®šè¦ ä½¿ç”¨getInstanceæ–¹æ³•æ¥è·å–å®ä¾‹

 ts  å¼ºåˆ¶ç”¨æˆ· å¿…é¡»ä½¿ç”¨getInstanceæ–¹æ³•æ¥è·å–å®ä¾‹ é€šè¿‡ private constructor
:::
```js
class Video {
  constructor(name) {
    this.name = name;
  }
  static getInstance(name) {
    if (!this.instance) {
      this.instance = new Video(name);
    }
    return this.instance;
  }
}
let a = Video.getInstance('a');
let b = Video.getInstance('b');
console.log(a === b); // true
```

## ä»£ç†å®ç°

### é”™è¯¯çš„ç¤ºèŒƒ

```js

const singleton = function (className) {
    let _ins;
    return class{
        constructor(...args) {
            return _ins || (_ins = new className(...args));
        }
    }
}

const SingleVideo = singleton(Video);

let a = new SingleVideo('a');
let b = new SingleVideo('b');
console.log(a === b); // true


SingleVideo.prototype.say = function () {
    console.log(this.name + 'say');
}
b.say(); // æ— æ³•è®¿é—®

```

### ğŸ“Œ ç”¨ proxy å®ç° 

```js

const singleton = function (className) {
    let _ins;
    return new Proxy(className, {
        construct(target, args) {
            return _ins || (_ins = new target(...args));
        }
    })
}

```

å‰ç«¯å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¼–å†™**å¯ç»´æŠ¤ã€å¯æ‰©å±•ã€ä½è€¦åˆ**çš„ä»£ç ç»“æ„ã€‚ä»¥ä¸‹æ˜¯å‰ç«¯å¼€å‘ä¸­**æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼æ€»ç»“**ï¼ŒåŒ…æ‹¬ç”¨é€”ã€ç¤ºä¾‹ä»¥åŠåœ¨å‰ç«¯ä¸­çš„åº”ç”¨åœºæ™¯ã€‚

---

## ğŸ”¹ 2. å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** æŠŠå¯¹è±¡åˆ›å»ºé€»è¾‘å°è£…èµ·æ¥ï¼Œæ ¹æ®æ¡ä»¶è¿”å›ä¸åŒå®ä¾‹ã€‚

```js
function createButton(type) {
  if (type === 'primary') {
    return new PrimaryButton();
  } else {
    return new DefaultButton();
  }
}
```

âœ… **ç”¨é€”ï¼š**

* åŠ¨æ€ç»„ä»¶æ¸²æŸ“ï¼ˆå¦‚ Element UI `el-button`ï¼‰
* è¡¨å•ç”Ÿæˆå™¨

---

## ğŸ”¹ 3. ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** å°†ä¸åŒçš„è¡Œä¸ºå°è£…æˆä¸åŒç­–ç•¥ç±»/å‡½æ•°ï¼Œå¯è‡ªç”±åˆ‡æ¢ã€‚

```js
const strategies = {
  isEmail: val => /\S+@\S+\.\S+/.test(val),
  isPhone: val => /^\d{11}$/.test(val)
};

function validate(type, val) {
  return strategies[type](val);
}
```

âœ… **ç”¨é€”ï¼š**

* è¡¨å•æ ¡éªŒ
* æ’åºç®—æ³•é€‰æ‹©

---

## ğŸ”¹ 4. å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ˆPublish-Subscribeï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** ä¸€æ–¹å‘å¸ƒäº‹ä»¶ï¼Œå¦ä¸€æ–¹ç›‘å¬å“åº”ï¼Œè§£è€¦æ¨¡å—ã€‚

```js
const EventBus = {
  events: {},
  on(event, cb) {
    (this.events[event] ||= []).push(cb);
  },
  emit(event, data) {
    (this.events[event] || []).forEach(fn => fn(data));
  }
};
```

âœ… **ç”¨é€”ï¼š**

* Vue çš„ `$emit` / `$on`
* ç»„ä»¶é€šä¿¡ã€çŠ¶æ€æ›´æ–°é€šçŸ¥

---

## ğŸ”¹ 5. è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** è¢«è§‚å¯Ÿå¯¹è±¡çŠ¶æ€å˜åŒ–æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…æ›´æ–°ã€‚

```js
class Subject {
  constructor() {
    this.observers = [];
  }
  attach(observer) {
    this.observers.push(observer);
  }
  notify(data) {
    this.observers.forEach(o => o.update(data));
  }
}
```

âœ… **ç”¨é€”ï¼š**

* Vue å“åº”å¼ç³»ç»Ÿï¼ˆProxy å®ç°è§‚å¯Ÿè€…ï¼‰
* MobX çŠ¶æ€å“åº”

---

## ğŸ”¹ 6. è£…é¥°å™¨æ¨¡å¼ï¼ˆDecoratorï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** åœ¨ä¸ä¿®æ”¹åŸå‡½æ•°/ç±»çš„å‰æä¸‹ï¼Œæ‰©å±•å…¶åŠŸèƒ½ã€‚

```js
function log(fn) {
  return function (...args) {
    console.log('è°ƒç”¨å‰');
    const result = fn(...args);
    console.log('è°ƒç”¨å');
    return result;
  };
}

const greet = log(name => `Hello, ${name}`);
```

âœ… **ç”¨é€”ï¼š**

* React é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰
* Vue/React è£…é¥°å™¨è¯­æ³•ï¼ˆ`@log`ï¼‰

---

## ğŸ”¹ 7. ä»£ç†æ¨¡å¼ï¼ˆProxyï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** ä½¿ç”¨ä»£ç†æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ã€‚

```js
const data = { name: 'Tom' };
const proxy = new Proxy(data, {
  get(target, key) {
    console.log(`è¯»å– ${key}`);
    return target[key];
  }
});
```

âœ… **ç”¨é€”ï¼š**

* Vue3 å“åº”å¼ç³»ç»Ÿ
* æ‡’åŠ è½½å›¾ç‰‡ã€æƒé™æ§åˆ¶

---

## ğŸ”¹ 8. ç»„åˆæ¨¡å¼ï¼ˆCompositeï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** æŠŠå¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ï¼Œç»Ÿä¸€å¯¹å¾…ä¸ªä½“å’Œæ•´ä½“ã€‚

```js
class Component {
  constructor(name) {
    this.name = name;
    this.children = [];
  }
  add(child) {
    this.children.push(child);
  }
}
```

âœ… **ç”¨é€”ï¼š**

* React/Vue ç»„ä»¶æ ‘
* æ ‘å½¢æ•°æ®ç»“æ„ï¼ˆå¦‚èœå•ã€æ–‡ä»¶å¤¹ï¼‰

---

## ğŸ”¹ 9. èŒè´£é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** å¤šä¸ªå¤„ç†å™¨ç»„æˆé“¾ï¼Œé€ä¸ªä¼ é€’è¯·æ±‚ï¼Œç›´åˆ°è¢«å¤„ç†ã€‚

```js
function handler1(req, next) {
  if (req.type === 'type1') {
    console.log('handler1 å¤„ç†');
  } else {
    next();
  }
}
```

âœ… **ç”¨é€”ï¼š**

* ä¸­é—´ä»¶æœºåˆ¶ï¼ˆExpressã€Koaï¼‰
* è¡¨å•æ ¡éªŒé“¾å¼ç»“æ„

---

## ğŸ”¹ 10. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼ˆTemplate Methodï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š** å®šä¹‰ç®—æ³•ç»“æ„ï¼Œå°†å…·ä½“å®ç°äº¤ç»™å­ç±»ã€‚

```js
class AbstractPage {
  render() {
    this.header();
    this.content();
    this.footer();
  }
  header() { console.log('Header') }
  content() { throw 'å®ç° me' }
  footer() { console.log('Footer') }
}
```

âœ… **ç”¨é€”ï¼š**

* é¡µé¢ç»“æ„å¤ç”¨
* Vue ç»„ä»¶ç»§æ‰¿å®ç°ç›¸åŒéª¨æ¶ä¸åŒå†…å®¹

---

## ğŸ”š æ€»ç»“è¡¨æ ¼

| è®¾è®¡æ¨¡å¼   | å…¸å‹åœºæ™¯                      |
| ------ | ------------------------- |
| å•ä¾‹æ¨¡å¼   | Vuexã€EventBusã€å…¨å±€ Modal ç®¡ç† |
| å·¥å‚æ¨¡å¼   | åŠ¨æ€ç»„ä»¶ã€è¡¨å•é¡¹ç”Ÿæˆ                |
| ç­–ç•¥æ¨¡å¼   | è¡¨å•éªŒè¯ã€ä¸šåŠ¡è§„åˆ™åˆ‡æ¢               |
| å‘å¸ƒè®¢é˜…   | ç»„ä»¶é€šä¿¡ã€å…¨å±€äº‹ä»¶                 |
| è§‚å¯Ÿè€…æ¨¡å¼  | Vue å“åº”å¼åŸç†                 |
| è£…é¥°å™¨æ¨¡å¼  | HOCã€é«˜é˜¶å‡½æ•°å¢å¼º                |
| ä»£ç†æ¨¡å¼   | Vue3 Proxyã€æ‡’åŠ è½½            |
| ç»„åˆæ¨¡å¼   | æ ‘å½¢ç»„ä»¶ã€èœå•ã€å±‚çº§ç»“æ„              |
| èŒè´£é“¾æ¨¡å¼  | ä¸­é—´ä»¶ã€è¡¨å•æ ¡éªŒ                  |
| æ¨¡æ¿æ–¹æ³•æ¨¡å¼ | é¡µé¢ç»“æ„å¤ç”¨                    |

---




