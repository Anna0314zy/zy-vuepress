---
title: ä»£ç é¢˜
tags:
   - é¢è¯•é¢˜
   - js
---
## æ¨¡æ‹Ÿå®ç° node event åº“

---

## âœ… åŠŸèƒ½æ”¯æŒï¼š

- `on(event, listener)`ï¼šæ³¨å†Œäº‹ä»¶ç›‘å¬å™¨  
- `emit(event, ...args)`ï¼šè§¦å‘äº‹ä»¶  
- `off(event, listener)`ï¼šç§»é™¤æŒ‡å®šç›‘å¬å™¨  
- `once(event, listener)`ï¼šæ³¨å†Œä¸€æ¬¡æ€§ç›‘å¬å™¨  

---

## ğŸ“¦ æ¨¡æ‹Ÿå®ç°ä»£ç ï¼š

```js
class EventEmitter {
  constructor() {
    this.events = new Map(); // å­˜å‚¨äº‹ä»¶åŠå…¶å›è°ƒ
  }

  // ç›‘å¬äº‹ä»¶
  on(event, callback) {
    if (!this.events.has(event)) {
      this.events.set(event, []);
    }
    this.events.get(event).push(callback);
  }

  // è§¦å‘äº‹ä»¶
  emit(event, ...args) {
    if (this.events.has(event)) {
      this.events.get(event).forEach(callback => callback(...args));
    }
  }

  // åªç›‘å¬ä¸€æ¬¡äº‹ä»¶
  once(event, callback) {
    const wrapper = (...args) => {
      callback(...args);
      this.off(event, wrapper); // è§¦å‘åç§»é™¤
    };
    this.on(event, wrapper);
  }

  // ç§»é™¤æŸä¸ªç›‘å¬äº‹ä»¶
  off(event, callback) {
    if (!this.events.has(event)) return;
    this.events.set(event, this.events.get(event).filter(cb => cb !== callback));
  }

  // ç§»é™¤æ‰€æœ‰ç›‘å¬äº‹ä»¶
  removeAllListeners(event) {
    if (this.events.has(event)) {
      this.events.delete(event);
    }
  }

  // è·å–æ‰€æœ‰äº‹ä»¶åç§°
  eventNames() {
    return [...this.events.keys()];
  }

  // è·å–æŸä¸ªäº‹ä»¶çš„ç›‘å¬å™¨æ•°é‡
  listenerCount(event) {
    return this.events.has(event) ? this.events.get(event).length : 0;
  }
}

```

---

## ğŸ§ª ä½¿ç”¨ç¤ºä¾‹ï¼š

```js
const emitter = new EventEmitter();

function greet(name) {
  console.log('Hello,', name);
}

emitter.on('hello', greet);
emitter.emit('hello', 'Alice'); // è¾“å‡ºï¼šHello, Alice

emitter.off('hello', greet);
emitter.emit('hello', 'Bob'); // æ— è¾“å‡º

emitter.once('hi', name => console.log('Hi', name));
emitter.emit('hi', 'Charlie'); // è¾“å‡ºï¼šHi Charlie
emitter.emit('hi', 'Dave');    // æ— è¾“å‡º
```

---
##  å°†ä¸€ç»„å¸¦æœ‰çˆ¶å­å…³ç³»çš„æ‰å¹³æ•°æ®è½¬æˆæ ‘å½¢ç»“æ„ã€‚
```js
function buildTree(data, idKey = 'id', parentKey = 'pid', childrenKey = 'children', extraPropsFn) {
    const treeMap = {};
    const tree = [];
  
    // æ·±æ‹·è´æ•°æ®ï¼Œé¿å…æ±¡æŸ“åŸæ•°æ®
    const dataCopy = JSON.parse(JSON.stringify(data));
  
    // å…ˆå»ºç«‹idæ˜ å°„è¡¨
    dataCopy.forEach(item => {
      // é¢å¤–å±æ€§å‡½æ•°ï¼Œç»™æ¯ä¸ªèŠ‚ç‚¹åŠ å±æ€§ï¼ˆå¯é€‰ï¼‰
      if (extraPropsFn && typeof extraPropsFn === 'function') {
        Object.assign(item, extraPropsFn(item));
      }
      treeMap[item[idKey]] = item;
    });
    // æ„é€ æ ‘å½¢ç»“æ„
    dataCopy.forEach(item => {
      const parent = treeMap[item[parentKey]];
      if (parent) {
        parent[childrenKey] = parent[childrenKey] || [];
        parent[childrenKey].push(item);
      } else {
        tree.push(item);
      }
    });
  
    return tree;
  }
  const flatData = [
    { id: 1, pid: 0, name: 'ä¸€çº§A' },
    { id: 2, pid: 1, name: 'äºŒçº§A-1' },
    { id: 3, pid: 1, name: 'äºŒçº§A-2' },
    { id: 4, pid: 0, name: 'ä¸€çº§B' },
    { id: 5, pid: 4, name: 'äºŒçº§B-1' },
    { id: 6, pid: 5, name: 'ä¸‰çº§A-1' }
  ];
  
  const treeData = buildTree(flatData, 'id', 'pid', 'children', item => ({ label: item.name }));
  
  console.log(treeData);  
```

##  æ ‘å½¢ç»“æ„ä½¿ç”¨æ ˆè¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†

```js
function findNode(tree, targetId) {
  if (!Array.isArray(tree)) return null;

  const stack = [...tree]; // ä½¿ç”¨æ ˆè¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†
  while (stack.length) {
    const node = stack.pop();
    if (node.id === targetId) {
      return node;
    }
    if (node.children) {
      stack.push(...node.children);
    }
  }
  return null;
}

const treeData = [
  {
    id: 1,
    name: 'èŠ‚ç‚¹ 1',
    children: [
      {
        id: 2,
        name: 'èŠ‚ç‚¹ 1-1',
        children: [
          {
            id: 5,
            name: 'èŠ‚ç‚¹ 1-1-1'
          }
        ]
      },
      {
        id: 3,
        name: 'èŠ‚ç‚¹ 1-2'
      }
    ]
  },
  {
    id: 4,
    name: 'èŠ‚ç‚¹ 2'
  }
];
const result = findNode(treeData, 5);
console.log(result);


```

## 1. 0.1 + 0.2 != 0.3
 0.1 å’Œ 0.2 åœ¨äºŒè¿›åˆ¶ä¸­è¡¨ç¤º
0.1  â†’  0.0001100110011001100110011001100110011...ï¼ˆæ— é™å¾ªç¯ï¼‰
0.2  â†’  0.0011001100110011001100110011001100110...ï¼ˆæ— é™å¾ªç¯ï¼‰
è®¡ç®— 0.1 + 0.2 æ—¶ï¼Œä¼šæœ‰èˆå…¥è¯¯å·®ï¼Œå¯¼è‡´ç»“æœç•¥å¤§äº 0.3
æœ€ç»ˆ 0.1 + 0.2 = 0.30000000000000004

## 2. æ•°ç»„çš„å¹¶é›† äº¤é›† å·®é›†

```js

const union = (arr1, arr2) => [...new Set([...arr1, ...arr2])];

console.log(union([1, 2, 3], [2, 3, 4])); // [1, 2, 3, 4]
// äº¤é›†

const intersection = (arr1, arr2) => arr1.filter(item => new Set(arr2).has(item));

console.log(intersection([1, 2, 3], [2, 3, 4])); // [2, 3]
// å·®é›†
const difference = (arr1, arr2) => arr1.filter(item => !new Set(arr2).has(item));

console.log(difference([1, 2, 3], [2, 3, 4])); // [1]
// å·®é›†
const differenceById = (arr1, arr2) =>
  arr1.filter(item1 => !arr2.some(item2 => item1.id === item2.id));

console.log(differenceById(data1, data2)); // [{ id: 1 }]

```

## promise ä»£ç æ‰§è¡Œé¡ºåº

```js

console.log(1);
async function async () {
    console.log(2);
    await console.log(3);
    console.log(4)
}
setTimeout(() => {
	console.log(5);
}, 0);
const promise = new Promise((resolve, reject) => {
    console.log(6);
    resolve(7)
})
promise.then(res => {
	console.log(res)
})
async (); 
console.log(8);
// åŒæ­¥ä»»åŠ¡å…ˆæ‰§è¡Œ  å¾®ä»»åŠ¡æ‰§è¡Œå®Œ ç„¶åå®ä»»åŠ¡æ‰§è¡Œ
// 1
// 6
// 2
// 3
// 8
// 7
// 4
// 5


```

##  createSearchParams
```js

/**
 * å…¼å®¹ IE çš„ createSearchParams å®ç°
 * @param init å¯¹è±¡æˆ–æ•°ç»„ï¼Œä¾‹å¦‚ { a: 1, b: 'test' }
 * @returns æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆä¸å¸¦ ?ï¼‰
 * encodeURIComponent æ˜¯ JavaScript å†…ç½®çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æŠŠå­—ç¬¦ä¸²è¿›è¡Œ URL ç¼–ç ï¼Œç¡®ä¿å®ƒå¯ä»¥å®‰å…¨åœ°æ”¾åœ¨ URL ä¸­ï¼Œä¸ä¼šå› ä¸ºç‰¹æ®Šå­—ç¬¦è€Œå‡ºé—®é¢˜ã€‚
 */
export function createSearchParamsCompat(
  init?: Record<string, string | number | boolean | null | undefined> | [string, string | number | boolean][]
): string {
  if (!init) return '';

  const pairs: string[] = [];

  if (Array.isArray(init)) {
    // æ•°ç»„å½¢å¼ï¼š[['a', 1], ['b', 'test']]
    init.forEach(([key, value]) => {
      if (value !== undefined && value !== null) {
        pairs.push(`${encodeURIComponent(key)}=${encodeURIComponent(String(value))}`);
      }
    });
  } else {
    // å¯¹è±¡å½¢å¼ï¼š{ a: 1, b: 'test' }
    Object.keys(init).forEach((key) => {
      const value = init[key];
      if (value !== undefined && value !== null) {
        pairs.push(`${encodeURIComponent(key)}=${encodeURIComponent(String(value))}`);
      }
    });
  }

  return pairs.join('&');
}

/**
 * æ ¹æ®ä¼ å…¥çš„å¯¹è±¡æˆ–æ•°ç»„ç”ŸæˆæŸ¥è¯¢å­—ç¬¦ä¸²
 * @param init å¯¹è±¡æˆ–æ•°ç»„ï¼Œä¾‹å¦‚ { a: 1, b: 'test' }
 * @returns URLSearchParams å®ä¾‹
 */
export function createSearchParams(init?: Record<string, string | number | boolean | null | undefined> | [string, string | number | boolean][]) {
  const params = new URLSearchParams();

  if (Array.isArray(init)) {
    // æ•°ç»„å½¢å¼ï¼š[ ['a', 1], ['b', 'test'] ]
    init.forEach(([key, value]) => {
      if (value !== undefined && value !== null) {
        params.append(key, String(value));
      }
    });
  } else if (init && typeof init === 'object') {
    // å¯¹è±¡å½¢å¼ï¼š{ a: 1, b: 'test' }
    Object.keys(init).forEach((key) => {
      const value = init[key];
      if (value !== undefined && value !== null) {
        params.append(key, String(value));
      }
    });
  }

  return params;
}

// ä½¿ç”¨ç¤ºä¾‹
const params = createSearchParams({ page: 1, keyword: 'abc' });
console.log(params.toString()); // page=1&keyword=abc
  
// ä½¿ç”¨ç¤ºä¾‹
const params = createSearchParams({ page: 1, keyword: 'abc' });
// page=1&keyword=abc
// btw
const url = new URL("https://example.com?foo=1&bar=2");
const params1 = new URLSearchParams(url.search);
params1.get('foo')


```